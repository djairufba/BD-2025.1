## SQL de Criação do Banco


```sql
-- Criação das tabelas de domínio

CREATE TABLE DM_TIPO_PESSOA (
    CODE_TIPO_PESSOA CHAR(2) NOT NULL,
    NM_TIPO_PESSOA VARCHAR(30) NOT NULL,
    NM_DESCRICAO VARCHAR(200),
    CONSTRAINT PK_TIPO_PESSOA PRIMARY KEY (CODE_TIPO_PESSOA)
);

CREATE TABLE DM_TITULACAO (
    CODE_TITULACAO CHAR(2) NOT NULL,
    NM_TITULACAO VARCHAR(30) NOT NULL,
    NM_DESCRICAO VARCHAR(200),
    CONSTRAINT PK_TITULACAO PRIMARY KEY (CODE_TITULACAO)
);

CREATE TABLE DM_NIVEL_CURSO (
    CODE_NIVEL CHAR(2) NOT NULL,
    NM_NIVEL VARCHAR(30) NOT NULL,
    NM_DESCRICAO VARCHAR(200),
    CONSTRAINT PK_NIVEL_CURSO PRIMARY KEY (CODE_NIVEL)
);

CREATE TABLE DM_REGIME_TRABALHO (
    CODE_REGIME_TRABALHO CHAR(2) NOT NULL,
    NM_REGIME VARCHAR(30) NOT NULL,
    NM_DESCRICAO VARCHAR(200),
    CONSTRAINT PK_REGIME_TRABALHO PRIMARY KEY (CODE_REGIME_TRABALHO)
);

CREATE TABLE DM_AREA_CONHECIMENTO (
    CODE_AREA_CONHECIMENTO CHAR(6) NOT NULL,
    NM_AREA VARCHAR(100) NOT NULL,
    NM_SUBAREA VARCHAR(100),
    NM_ESPECIALIDADE VARCHAR(100),
    CONSTRAINT PK_AREA_CONHECIMENTO PRIMARY KEY (CODE_AREA_CONHECIMENTO)
);

CREATE TABLE DM_TIPO_INSTITUICAO (
    CODE_TIPO_INSTITUICAO CHAR(2) NOT NULL,
    NM_TIPO VARCHAR(30) NOT NULL,
    NM_DESCRICAO VARCHAR(200),
    CONSTRAINT PK_TIPO_INSTITUICAO PRIMARY KEY (CODE_TIPO_INSTITUICAO)
);

CREATE TABLE DM_PAIS (
    CODE_PAIS CHAR(3) NOT NULL,
    NM_PAIS VARCHAR(60) NOT NULL,
    NM_SIGLA CHAR(2),
    CONSTRAINT PK_PAIS PRIMARY KEY (CODE_PAIS)
);

CREATE TABLE DM_PAPEL_GRUPO (
    CODE_PAPEL CHAR(2) NOT NULL,
    NM_PAPEL VARCHAR(30) NOT NULL,
    NM_DESCRICAO VARCHAR(200),
    CONSTRAINT PK_PAPEL_GRUPO PRIMARY KEY (CODE_PAPEL)
);

CREATE TABLE DM_SITUACAO_GRUPO (
    CODE_SITUACAO CHAR(2) NOT NULL,
    NM_SITUACAO VARCHAR(30) NOT NULL,
    NM_DESCRICAO VARCHAR(200),
    CONSTRAINT PK_SITUACAO_GRUPO PRIMARY KEY (CODE_SITUACAO)
);

CREATE TABLE DM_TIPO_ORIENTACAO (
    CODE_TIPO_ORIENTACAO CHAR(2) NOT NULL,
    NM_TIPO VARCHAR(30) NOT NULL,
    NM_DESCRICAO VARCHAR(200),
    CNT_DURACAO_PADRAO_MESES INTEGER,
    CONSTRAINT PK_TIPO_ORIENTACAO PRIMARY KEY (CODE_TIPO_ORIENTACAO)
);

CREATE TABLE DM_SITUACAO_PROJETO (
    CODE_SITUACAO CHAR(2) NOT NULL,
    NM_SITUACAO VARCHAR(30) NOT NULL,
    NM_DESCRICAO VARCHAR(200),
    CONSTRAINT PK_SITUACAO_PROJETO PRIMARY KEY (CODE_SITUACAO)
);

CREATE TABLE DM_TIPO_BANCA (
    CODE_TIPO_BANCA CHAR(2) NOT NULL,
    NM_TIPO VARCHAR(30) NOT NULL,
    NM_DESCRICAO VARCHAR(200),
    CONSTRAINT PK_TIPO_BANCA PRIMARY KEY (CODE_TIPO_BANCA)
);

CREATE TABLE DM_RESULTADO_BANCA (
    CODE_RESULTADO CHAR(2) NOT NULL,
    NM_RESULTADO VARCHAR(30) NOT NULL,
    NM_DESCRICAO VARCHAR(200),
    CONSTRAINT PK_RESULTADO_BANCA PRIMARY KEY (CODE_RESULTADO)
);

CREATE TABLE DM_TIPO_FINANCIAMENTO (
    CODE_TIPO_FINANCIAMENTO CHAR(2) NOT NULL,
    NM_TIPO VARCHAR(30) NOT NULL,
    NM_DESCRICAO VARCHAR(200),
    CONSTRAINT PK_TIPO_FINANCIAMENTO PRIMARY KEY (CODE_TIPO_FINANCIAMENTO)
);

CREATE TABLE DM_MOEDA (
    CODE_MOEDA CHAR(3) NOT NULL,
    NM_MOEDA VARCHAR(30) NOT NULL,
    NM_SIGLA CHAR(3),
    NM_SIMBOLO CHAR(5),
    CONSTRAINT PK_MOEDA PRIMARY KEY (CODE_MOEDA)
);

CREATE TABLE DM_SITUACAO_FINANCIAMENTO (
    CODE_SITUACAO CHAR(2) NOT NULL,
    NM_SITUACAO VARCHAR(30) NOT NULL,
    NM_DESCRICAO VARCHAR(200),
    CONSTRAINT PK_SITUACAO_FINANCIAMENTO PRIMARY KEY (CODE_SITUACAO)
);

CREATE TABLE DM_TIPO_BOLSA (
    CODE_TIPO_BOLSA CHAR(2) NOT NULL,
    NM_TIPO VARCHAR(30) NOT NULL,
    NM_DESCRICAO VARCHAR(200),
    CNT_VALOR_REFERENCIA DECIMAL(10,2),
    CONSTRAINT PK_TIPO_BOLSA PRIMARY KEY (CODE_TIPO_BOLSA)
);

CREATE TABLE DM_TIPO_PUBLICACAO (
    CODE_TIPO_PUBLICACAO CHAR(2) NOT NULL,
    NM_TIPO VARCHAR(30) NOT NULL,
    NM_DESCRICAO VARCHAR(200),
    CONSTRAINT PK_TIPO_PUBLICACAO PRIMARY KEY (CODE_TIPO_PUBLICACAO)
);

CREATE TABLE DM_TIPO_VEICULO (
    CODE_TIPO_VEICULO CHAR(2) NOT NULL,
    NM_TIPO VARCHAR(30) NOT NULL,
    NM_DESCRICAO VARCHAR(200),
    CONSTRAINT PK_TIPO_VEICULO PRIMARY KEY (CODE_TIPO_VEICULO)
);

CREATE TABLE DM_IDIOMA (
    CODE_IDIOMA CHAR(2) NOT NULL,
    NM_IDIOMA VARCHAR(30) NOT NULL,
    NM_SIGLA CHAR(2),
    CONSTRAINT PK_IDIOMA PRIMARY KEY (CODE_IDIOMA)
);

CREATE TABLE DM_TIPO_EVENTO (
    CODE_TIPO_EVENTO CHAR(2) NOT NULL,
    NM_TIPO VARCHAR(30) NOT NULL,
    NM_DESCRICAO VARCHAR(200),
    CONSTRAINT PK_TIPO_EVENTO PRIMARY KEY (CODE_TIPO_EVENTO)
);

CREATE TABLE DM_TIPO_PARTICIPACAO (
    CODE_TIPO_PARTICIPACAO CHAR(2) NOT NULL,
    NM_TIPO VARCHAR(30) NOT NULL,
    NM_DESCRICAO VARCHAR(200),
    CONSTRAINT PK_TIPO_PARTICIPACAO PRIMARY KEY (CODE_TIPO_PARTICIPACAO)
);

CREATE TABLE DM_TIPO_DESPESA (
    CODE_TIPO_DESPESA CHAR(2) NOT NULL,
    NM_TIPO VARCHAR(30) NOT NULL,
    NM_DESCRICAO VARCHAR(200),
    CONSTRAINT PK_TIPO_DESPESA PRIMARY KEY (CODE_TIPO_DESPESA)
);

-- Criação das tabelas principais

CREATE TABLE TB_INSTITUICAO (
    UID_INSTITUICAO VARCHAR(36) NOT NULL,
    NM_INSTITUICAO VARCHAR(100) NOT NULL,
    NM_SIGLA VARCHAR(20),
    CODE_TIPO_INSTITUICAO CHAR(2) NOT NULL,
    CODE_PAIS CHAR(3) NOT NULL,
    NM_CIDADE VARCHAR(50),
    NM_ESTADO VARCHAR(50),
    NM_ENDERECO VARCHAR(200),
    NM_SITE VARCHAR(100),
    ST_REGISTRO_ATIVO CHAR(1) DEFAULT 'S',
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_INSTITUICAO PRIMARY KEY (UID_INSTITUICAO),
    CONSTRAINT FK_INSTITUICAO_TIPO FOREIGN KEY (CODE_TIPO_INSTITUICAO) 
        REFERENCES DM_TIPO_INSTITUICAO(CODE_TIPO_INSTITUICAO),
    CONSTRAINT FK_INSTITUICAO_PAIS FOREIGN KEY (CODE_PAIS) 
        REFERENCES DM_PAIS(CODE_PAIS),
    CONSTRAINT CK_INSTITUICAO_ATIVO CHECK (ST_REGISTRO_ATIVO IN ('S', 'N'))
);

CREATE TABLE TB_DEPARTAMENTO (
    UID_DEPARTAMENTO VARCHAR(36) NOT NULL,
    UID_INSTITUICAO VARCHAR(36) NOT NULL,
    NM_DEPARTAMENTO VARCHAR(100) NOT NULL,
    NM_SIGLA VARCHAR(20),
    NM_AREA_CONHECIMENTO VARCHAR(100),
    ST_REGISTRO_ATIVO CHAR(1) DEFAULT 'S',
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_DEPARTAMENTO PRIMARY KEY (UID_DEPARTAMENTO),
    CONSTRAINT FK_DEPARTAMENTO_INSTITUICAO FOREIGN KEY (UID_INSTITUICAO) 
        REFERENCES TB_INSTITUICAO(UID_INSTITUICAO),
    CONSTRAINT CK_DEPARTAMENTO_ATIVO CHECK (ST_REGISTRO_ATIVO IN ('S', 'N'))
);

CREATE TABLE TB_CURSO (
    UID_CURSO VARCHAR(36) NOT NULL,
    UID_DEPARTAMENTO VARCHAR(36) NOT NULL,
    NM_CURSO VARCHAR(100) NOT NULL,
    CODE_NIVEL CHAR(2) NOT NULL,
    NM_SIGLA VARCHAR(20),
    CODE_AREA_CONHECIMENTO CHAR(6),
    CNT_DURACAO_MESES INTEGER,
    ST_REGISTRO_ATIVO CHAR(1) DEFAULT 'S',
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_CURSO PRIMARY KEY (UID_CURSO),
    CONSTRAINT FK_CURSO_DEPARTAMENTO FOREIGN KEY (UID_DEPARTAMENTO) 
        REFERENCES TB_DEPARTAMENTO(UID_DEPARTAMENTO),
    CONSTRAINT FK_CURSO_NIVEL FOREIGN KEY (CODE_NIVEL) 
        REFERENCES DM_NIVEL_CURSO(CODE_NIVEL),
    CONSTRAINT FK_CURSO_AREA FOREIGN KEY (CODE_AREA_CONHECIMENTO) 
        REFERENCES DM_AREA_CONHECIMENTO(CODE_AREA_CONHECIMENTO),
    CONSTRAINT CK_CURSO_ATIVO CHECK (ST_REGISTRO_ATIVO IN ('S', 'N'))
);

CREATE TABLE TB_PESSOA (
    UID_PESSOA VARCHAR(36) NOT NULL,
    CODE_TIPO_PESSOA CHAR(2) NOT NULL,
    NM_PESSOA VARCHAR(100) NOT NULL,
    DATE_NASCIMENTO DATE,
    CODE_NACIONALIDADE CHAR(3),
    NM_EMAIL VARCHAR(100),
    NM_TELEFONE VARCHAR(20),
    FLAG_ATIVO CHAR(1) DEFAULT 'S' NOT NULL,
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_PESSOA PRIMARY KEY (UID_PESSOA),
    CONSTRAINT FK_PESSOA_TIPO FOREIGN KEY (CODE_TIPO_PESSOA) 
        REFERENCES DM_TIPO_PESSOA(CODE_TIPO_PESSOA),
    CONSTRAINT FK_PESSOA_NACIONALIDADE FOREIGN KEY (CODE_NACIONALIDADE) 
        REFERENCES DM_PAIS(CODE_PAIS),
    CONSTRAINT CK_PESSOA_ATIVO CHECK (FLAG_ATIVO IN ('S', 'N'))
);

CREATE TABLE TB_PROFESSOR (
    UID_PESSOA VARCHAR(36) NOT NULL,
    CODE_TITULACAO CHAR(2) NOT NULL,
    NM_FUNCIONAL VARCHAR(20),
    DATE_CONTRATACAO DATE,
    UID_DEPARTAMENTO VARCHAR(36) NOT NULL,
    CODE_REGIME_TRABALHO CHAR(2) NOT NULL,
    NM_CURRICULO_LATTES VARCHAR(100),
    NM_ORCID VARCHAR(50),
    ST_REGISTRO_ATIVO CHAR(1) DEFAULT 'S',
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_PROFESSOR PRIMARY KEY (UID_PESSOA),
    CONSTRAINT FK_PROFESSOR_PESSOA FOREIGN KEY (UID_PESSOA) 
        REFERENCES TB_PESSOA(UID_PESSOA),
    CONSTRAINT FK_PROFESSOR_TITULACAO FOREIGN KEY (CODE_TITULACAO) 
        REFERENCES DM_TITULACAO(CODE_TITULACAO),
    CONSTRAINT FK_PROFESSOR_DEPARTAMENTO FOREIGN KEY (UID_DEPARTAMENTO) 
        REFERENCES TB_DEPARTAMENTO(UID_DEPARTAMENTO),
    CONSTRAINT FK_PROFESSOR_REGIME FOREIGN KEY (CODE_REGIME_TRABALHO) 
        REFERENCES DM_REGIME_TRABALHO(CODE_REGIME_TRABALHO),
    CONSTRAINT CK_PROFESSOR_ATIVO CHECK (ST_REGISTRO_ATIVO IN ('S', 'N'))
);

CREATE TABLE TB_ESTUDANTE (
    UID_PESSOA VARCHAR(36) NOT NULL,
    NM_MATRICULA VARCHAR(20) NOT NULL,
    CODE_NIVEL_CURSO CHAR(2) NOT NULL,
    DATE_INGRESSO DATE NOT NULL,
    DATE_CONCLUSAO_PREVISTA DATE,
    UID_CURSO VARCHAR(36) NOT NULL,
    FLAG_BOLSISTA CHAR(1) DEFAULT 'N',
    ST_REGISTRO_ATIVO CHAR(1) DEFAULT 'S',
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_ESTUDANTE PRIMARY KEY (UID_PESSOA),
    CONSTRAINT FK_ESTUDANTE_PESSOA FOREIGN KEY (UID_PESSOA) 
        REFERENCES TB_PESSOA(UID_PESSOA),
    CONSTRAINT FK_ESTUDANTE_NIVEL FOREIGN KEY (CODE_NIVEL_CURSO) 
        REFERENCES DM_NIVEL_CURSO(CODE_NIVEL),
    CONSTRAINT FK_ESTUDANTE_CURSO FOREIGN KEY (UID_CURSO) 
        REFERENCES TB_CURSO(UID_CURSO),
    CONSTRAINT CK_ESTUDANTE_ATIVO CHECK (ST_REGISTRO_ATIVO IN ('S', 'N')),
    CONSTRAINT CK_ESTUDANTE_BOLSISTA CHECK (FLAG_BOLSISTA IN ('S', 'N')),
    CONSTRAINT UK_ESTUDANTE_MATRICULA UNIQUE (NM_MATRICULA)
);

CREATE TABLE TB_FORMACAO_ACADEMICA (
    UID_FORMACAO VARCHAR(36) NOT NULL,
    UID_PESSOA VARCHAR(36) NOT NULL,
    UID_INSTITUICAO VARCHAR(36) NOT NULL,
    NM_CURSO VARCHAR(100) NOT NULL,
    CODE_NIVEL CHAR(2) NOT NULL,
    DATE_INICIO DATE NOT NULL,
    DATE_CONCLUSAO DATE,
    NM_TITULO_TRABALHO VARCHAR(200),
    FLAG_EM_ANDAMENTO CHAR(1) DEFAULT 'N',
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_FORMACAO PRIMARY KEY (UID_FORMACAO),
    CONSTRAINT FK_FORMACAO_PESSOA FOREIGN KEY (UID_PESSOA) 
        REFERENCES TB_PESSOA(UID_PESSOA),
    CONSTRAINT FK_FORMACAO_INSTITUICAO FOREIGN KEY (UID_INSTITUICAO) 
        REFERENCES TB_INSTITUICAO(UID_INSTITUICAO),
    CONSTRAINT FK_FORMACAO_NIVEL FOREIGN KEY (CODE_NIVEL) 
        REFERENCES DM_NIVEL_CURSO(CODE_NIVEL),
    CONSTRAINT CK_FORMACAO_EM_ANDAMENTO CHECK (FLAG_EM_ANDAMENTO IN ('S', 'N')),
    CONSTRAINT CK_FORMACAO_DATAS CHECK (
        DATE_INICIO <= DATE_CONCLUSAO OR 
        (DATE_CONCLUSAO IS NULL AND FLAG_EM_ANDAMENTO = 'S')
    )
);

CREATE TABLE TB_GRUPO_PESQUISA (
    UID_GRUPO VARCHAR(36) NOT NULL,
    NM_GRUPO VARCHAR(100) NOT NULL,
    NM_DESCRICAO VARCHAR(4000),
    DATE_CRIACAO DATE NOT NULL,
    UID_LIDER VARCHAR(36) NOT NULL,
    UID_INSTITUICAO VARCHAR(36) NOT NULL,
    NM_SITE VARCHAR(100),
    CODE_SITUACAO CHAR(2) NOT NULL,
    NM_CERTIFICACAO_CNPQ VARCHAR(50),
    ST_REGISTRO_ATIVO CHAR(1) DEFAULT 'S',
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_GRUPO PRIMARY KEY (UID_GRUPO),
    CONSTRAINT FK_GRUPO_LIDER FOREIGN KEY (UID_LIDER) 
        REFERENCES TB_PESSOA(UID_PESSOA),
    CONSTRAINT FK_GRUPO_INSTITUICAO FOREIGN KEY (UID_INSTITUICAO) 
        REFERENCES TB_INSTITUICAO(UID_INSTITUICAO),
    CONSTRAINT FK_GRUPO_SITUACAO FOREIGN KEY (CODE_SITUACAO) 
        REFERENCES DM_SITUACAO_GRUPO(CODE_SITUACAO),
    CONSTRAINT CK_GRUPO_ATIVO CHECK (ST_REGISTRO_ATIVO IN ('S', 'N'))
);

CREATE TABLE TB_LINHA_PESQUISA (
    UID_LINHA VARCHAR(36) NOT NULL,
    UID_GRUPO VARCHAR(36) NOT NULL,
    NM_LINHA VARCHAR(100) NOT NULL,
    NM_DESCRICAO VARCHAR(4000),
    NM_PALAVRAS_CHAVE VARCHAR(200),
    ST_REGISTRO_ATIVO CHAR(1) DEFAULT 'S',
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_LINHA PRIMARY KEY (UID_LINHA),
    CONSTRAINT FK_LINHA_GRUPO FOREIGN KEY (UID_GRUPO) 
        REFERENCES TB_GRUPO_PESQUISA(UID_GRUPO),
    CONSTRAINT CK_LINHA_ATIVO CHECK (ST_REGISTRO_ATIVO IN ('S', 'N'))
);

CREATE TABLE RT_MEMBRO_GRUPO (
    UID_MEMBRO_GRUPO VARCHAR(36) NOT NULL,
    UID_GRUPO VARCHAR(36) NOT NULL,
    UID_PESSOA VARCHAR(36) NOT NULL,
    CODE_PAPEL CHAR(2) NOT NULL,
    DATE_INICIO DATE NOT NULL,
    DATE_FIM DATE,
    FLAG_ATIVO CHAR(1) DEFAULT 'S',
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_MEMBRO_GRUPO PRIMARY KEY (UID_MEMBRO_GRUPO),
    CONSTRAINT FK_MEMBRO_GRUPO_GRUPO FOREIGN KEY (UID_GRUPO) 
        REFERENCES TB_GRUPO_PESQUISA(UID_GRUPO),
    CONSTRAINT FK_MEMBRO_GRUPO_PESSOA FOREIGN KEY (UID_PESSOA) 
        REFERENCES TB_PESSOA(UID_PESSOA),
    CONSTRAINT FK_MEMBRO_GRUPO_PAPEL FOREIGN KEY (CODE_PAPEL) 
        REFERENCES DM_PAPEL_GRUPO(CODE_PAPEL),
    CONSTRAINT CK_MEMBRO_GRUPO_ATIVO CHECK (FLAG_ATIVO IN ('S', 'N')),
    CONSTRAINT CK_MEMBRO_GRUPO_DATAS CHECK (
        DATE_INICIO <= DATE_FIM OR DATE_FIM IS NULL
    )
);

CREATE TABLE TB_PROJETO (
    UID_PROJETO VARCHAR(36) NOT NULL,
    NM_PROJETO VARCHAR(200) NOT NULL,
    NM_DESCRICAO VARCHAR(4000),
    UID_COORDENADOR VARCHAR(36) NOT NULL,
    UID_GRUPO VARCHAR(36),
    UID_LINHA VARCHAR(36),
    DATE_INICIO DATE NOT NULL,
    DATE_FIM_PREVISTO DATE,
    DATE_FIM_REAL DATE,
    CODE_SITUACAO CHAR(2) NOT NULL,
    NM_RESULTADOS_ESPERADOS VARCHAR(4000),
    ST_REGISTRO_ATIVO CHAR(1) DEFAULT 'S',
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_PROJETO PRIMARY KEY (UID_PROJETO),
    CONSTRAINT FK_PROJETO_COORDENADOR FOREIGN KEY (UID_COORDENADOR) 
        REFERENCES TB_PESSOA(UID_PESSOA),
    CONSTRAINT FK_PROJETO_GRUPO FOREIGN KEY (UID_GRUPO) 
        REFERENCES TB_GRUPO_PESQUISA(UID_GRUPO),
    CONSTRAINT FK_PROJETO_LINHA FOREIGN KEY (UID_LINHA) 
        REFERENCES TB_LINHA_PESQUISA(UID_LINHA),
    CONSTRAINT FK_PROJETO_SITUACAO FOREIGN KEY (CODE_SITUACAO) 
        REFERENCES DM_SITUACAO_PROJETO(CODE_SITUACAO),
    CONSTRAINT CK_PROJETO_ATIVO CHECK (ST_REGISTRO_ATIVO IN ('S', 'N')),
    CONSTRAINT CK_PROJETO_DATAS CHECK (
        DATE_INICIO <= DATE_FIM_PREVISTO AND
        (DATE_FIM_REAL IS NULL OR DATE_INICIO <= DATE_FIM_REAL)
    )
);

CREATE TABLE RT_MEMBRO_PROJETO (
    UID_MEMBRO_PROJETO VARCHAR(36) NOT NULL,
    UID_PROJETO VARCHAR(36) NOT NULL,
    UID_PESSOA VARCHAR(36) NOT NULL,
    CODE_PAPEL CHAR(2) NOT NULL,
    DATE_INICIO DATE NOT NULL,
    DATE_FIM DATE,
    NM_ATRIBUICOES VARCHAR(1000),
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_MEMBRO_PROJETO PRIMARY KEY (UID_MEMBRO_PROJETO),
    CONSTRAINT FK_MEMBRO_PROJETO_PROJETO FOREIGN KEY (UID_PROJETO) 
        REFERENCES TB_PROJETO(UID_PROJETO),
    CONSTRAINT FK_MEMBRO_PROJETO_PESSOA FOREIGN KEY (UID_PESSOA) 
        REFERENCES TB_PESSOA(UID_PESSOA),
    CONSTRAINT FK_MEMBRO_PROJETO_PAPEL FOREIGN KEY (CODE_PAPEL) 
        REFERENCES DM_PAPEL_GRUPO(CODE_PAPEL),
    CONSTRAINT CK_MEMBRO_PROJETO_DATAS CHECK (
        DATE_INICIO <= DATE_FIM OR DATE_FIM IS NULL
    )
);

CREATE TABLE TB_ORIENTACAO (
    UID_ORIENTACAO VARCHAR(36) NOT NULL,
    UID_ORIENTADOR VARCHAR(36) NOT NULL,
    UID_ORIENTANDO VARCHAR(36) NOT NULL,
    UID_PROJETO VARCHAR(36),
    CODE_TIPO_ORIENTACAO CHAR(2) NOT NULL,
    NM_TITULO VARCHAR(200) NOT NULL,
    NM_DESCRICAO VARCHAR(4000),
    DATE_INICIO DATE NOT NULL,
    DATE_FIM_PREVISTO DATE,
    DATE_FIM_REAL DATE,
    CODE_SITUACAO CHAR(2) NOT NULL,
    DATE_QUALIFICACAO DATE,
    DATE_DEFESA DATE,
    ST_REGISTRO_ATIVO CHAR(1) DEFAULT 'S',
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_ORIENTACAO PRIMARY KEY (UID_ORIENTACAO),
    CONSTRAINT FK_ORIENTACAO_ORIENTADOR FOREIGN KEY (UID_ORIENTADOR) 
        REFERENCES TB_PROFESSOR(UID_PESSOA),
    CONSTRAINT FK_ORIENTACAO_ORIENTANDO FOREIGN KEY (UID_ORIENTANDO) 
        REFERENCES TB_ESTUDANTE(UID_PESSOA),
    CONSTRAINT FK_ORIENTACAO_PROJETO FOREIGN KEY (UID_PROJETO) 
        REFERENCES TB_PROJETO(UID_PROJETO),
    CONSTRAINT FK_ORIENTACAO_TIPO FOREIGN KEY (CODE_TIPO_ORIENTACAO) 
        REFERENCES DM_TIPO_ORIENTACAO(CODE_TIPO_ORIENTACAO),
    CONSTRAINT FK_ORIENTACAO_SITUACAO FOREIGN KEY (CODE_SITUACAO) 
        REFERENCES DM_SITUACAO_PROJETO(CODE_SITUACAO),
    CONSTRAINT CK_ORIENTACAO_ATIVO CHECK (ST_REGISTRO_ATIVO IN ('S', 'N')),
    CONSTRAINT CK_ORIENTACAO_DATAS CHECK (
        DATE_INICIO <= DATE_FIM_PREVISTO AND
        (DATE_FIM_REAL IS NULL OR DATE_INICIO <= DATE_FIM_REAL) AND
        (DATE_QUALIFICACAO IS NULL OR DATE_INICIO <= DATE_QUALIFICACAO) AND
        (DATE_DEFESA IS NULL OR 
            (DATE_QUALIFICACAO IS NULL OR DATE_QUALIFICACAO <= DATE_DEFESA))
    )
);

CREATE TABLE TB_COORIENTACAO (
    UID_COORIENTACAO VARCHAR(36) NOT NULL,
    UID_ORIENTACAO VARCHAR(36) NOT NULL,
    UID_COORIENTADOR VARCHAR(36) NOT NULL,
    DATE_INICIO DATE NOT NULL,
    DATE_FIM DATE,
    ST_REGISTRO_ATIVO CHAR(1) DEFAULT 'S',
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_COORIENTACAO PRIMARY KEY (UID_COORIENTACAO),
    CONSTRAINT FK_COORIENTACAO_ORIENTACAO FOREIGN KEY (UID_ORIENTACAO) 
        REFERENCES TB_ORIENTACAO(UID_ORIENTACAO),
    CONSTRAINT FK_COORIENTACAO_COORIENTADOR FOREIGN KEY (UID_COORIENTADOR) 
        REFERENCES TB_PROFESSOR(UID_PESSOA),
    CONSTRAINT CK_COORIENTACAO_ATIVO CHECK (ST_REGISTRO_ATIVO IN ('S', 'N')),
    CONSTRAINT CK_COORIENTACAO_DATAS CHECK (
        DATE_INICIO <= DATE_FIM OR DATE_FIM IS NULL
    )
);

CREATE TABLE TB_BANCA (
    UID_BANCA VARCHAR(36) NOT NULL,
    UID_ORIENTACAO VARCHAR(36) NOT NULL,
    CODE_TIPO_BANCA CHAR(2) NOT NULL,
    DATE_REALIZACAO DATE NOT NULL,
    NM_LOCAL VARCHAR(100),
    NM_HORA VARCHAR(5),
    CODE_RESULTADO CHAR(2),
    NM_OBSERVACOES VARCHAR(1000),
    ST_REGISTRO_ATIVO CHAR(1) DEFAULT 'S',
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_BANCA PRIMARY KEY (UID_BANCA),
    CONSTRAINT FK_BANCA_ORIENTACAO FOREIGN KEY (UID_ORIENTACAO) 
        REFERENCES TB_ORIENTACAO(UID_ORIENTACAO),
    CONSTRAINT FK_BANCA_TIPO FOREIGN KEY (CODE_TIPO_BANCA) 
        REFERENCES DM_TIPO_BANCA(CODE_TIPO_BANCA),
    CONSTRAINT FK_BANCA_RESULTADO FOREIGN KEY (CODE_RESULTADO) 
        REFERENCES DM_RESULTADO_BANCA(CODE_RESULTADO),
    CONSTRAINT CK_BANCA_ATIVO CHECK (ST_REGISTRO_ATIVO IN ('S', 'N'))
);

CREATE TABLE RT_MEMBRO_BANCA (
    UID_MEMBRO_BANCA VARCHAR(36) NOT NULL,
    UID_BANCA VARCHAR(36) NOT NULL,
    UID_PESSOA VARCHAR(36) NOT NULL,
    CODE_PAPEL CHAR(2) NOT NULL,
    FLAG_EXTERNO CHAR(1) DEFAULT 'N',
    UID_INSTITUICAO_ORIGEM VARCHAR(36),
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_MEMBRO_BANCA PRIMARY KEY (UID_MEMBRO_BANCA),
    CONSTRAINT FK_MEMBRO_BANCA_BANCA FOREIGN KEY (UID_BANCA) 
        REFERENCES TB_BANCA(UID_BANCA),
    CONSTRAINT FK_MEMBRO_BANCA_PESSOA FOREIGN KEY (UID_PESSOA) 
        REFERENCES TB_PESSOA(UID_PESSOA),
    CONSTRAINT FK_MEMBRO_BANCA_PAPEL FOREIGN KEY (CODE_PAPEL) 
        REFERENCES DM_PAPEL_GRUPO(CODE_PAPEL),
    CONSTRAINT FK_MEMBRO_BANCA_INSTITUICAO FOREIGN KEY (UID_INSTITUICAO_ORIGEM) 
        REFERENCES TB_INSTITUICAO(UID_INSTITUICAO),
    CONSTRAINT CK_MEMBRO_BANCA_EXTERNO CHECK (FLAG_EXTERNO IN ('S', 'N')),
    CONSTRAINT CK_MEMBRO_BANCA_INST_EXT CHECK (
        (FLAG_EXTERNO = 'S' AND UID_INSTITUICAO_ORIGEM IS NOT NULL) OR
        (FLAG_EXTERNO = 'N')
    )
);

CREATE TABLE TB_FINANCIAMENTO (
    UID_FINANCIAMENTO VARCHAR(36) NOT NULL,
    CODE_TIPO_FINANCIAMENTO CHAR(2) NOT NULL,
    UID_PROJETO VARCHAR(36),
    UID_ORIENTACAO VARCHAR(36),
    UID_INSTITUICAO_FINANCIADORA VARCHAR(36) NOT NULL,
    NM_EDITAL VARCHAR(100),
    NM_NUMERO_PROCESSO VARCHAR(50),
    DATE_INICIO DATE NOT NULL,
    DATE_FIM DATE,
    CNT_VALOR_TOTAL DECIMAL(15,2) NOT NULL,
    CODE_MOEDA CHAR(3) NOT NULL,
    CODE_SITUACAO CHAR(2) NOT NULL,
    ST_REGISTRO_ATIVO CHAR(1) DEFAULT 'S',
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_FINANCIAMENTO PRIMARY KEY (UID_FINANCIAMENTO),
    CONSTRAINT FK_FINANCIAMENTO_TIPO FOREIGN KEY (CODE_TIPO_FINANCIAMENTO) 
        REFERENCES DM_TIPO_FINANCIAMENTO(CODE_TIPO_FINANCIAMENTO),
    CONSTRAINT FK_FINANCIAMENTO_PROJETO FOREIGN KEY (UID_PROJETO) 
        REFERENCES TB_PROJETO(UID_PROJETO),
    CONSTRAINT FK_FINANCIAMENTO_ORIENTACAO FOREIGN KEY (UID_ORIENTACAO) 
        REFERENCES TB_ORIENTACAO(UID_ORIENTACAO),
    CONSTRAINT FK_FINANCIAMENTO_INSTITUICAO FOREIGN KEY (UID_INSTITUICAO_FINANCIADORA) 
        REFERENCES TB_INSTITUICAO(UID_INSTITUICAO),
    CONSTRAINT FK_FINANCIAMENTO_MOEDA FOREIGN KEY (CODE_MOEDA) 
        REFERENCES DM_MOEDA(CODE_MOEDA),
    CONSTRAINT FK_FINANCIAMENTO_SITUACAO FOREIGN KEY (CODE_SITUACAO) 
        REFERENCES DM_SITUACAO_FINANCIAMENTO(CODE_SITUACAO),
    CONSTRAINT CK_FINANCIAMENTO_ATIVO CHECK (ST_REGISTRO_ATIVO IN ('S', 'N')),
    CONSTRAINT CK_FINANCIAMENTO_ALVO CHECK (
        (UID_PROJETO IS NOT NULL AND UID_ORIENTACAO IS NULL) OR
        (UID_PROJETO IS NULL AND UID_ORIENTACAO IS NOT NULL) OR
        (UID_PROJETO IS NOT NULL AND UID_ORIENTACAO IS NOT NULL)
    ),
    CONSTRAINT CK_FINANCIAMENTO_DATAS CHECK (
        DATE_INICIO <= DATE_FIM OR DATE_FIM IS NULL
    )
);

CREATE TABLE TB_BOLSA (
    UID_BOLSA VARCHAR(36) NOT NULL,
    UID_FINANCIAMENTO VARCHAR(36) NOT NULL,
    UID_BOLSISTA VARCHAR(36) NOT NULL,
    CODE_TIPO_BOLSA CHAR(2) NOT NULL,
    DATE_INICIO DATE NOT NULL,
    DATE_FIM DATE,
    CNT_VALOR_MENSAL DECIMAL(10,2) NOT NULL,
    CODE_SITUACAO CHAR(2) NOT NULL,
    ST_REGISTRO_ATIVO CHAR(1) DEFAULT 'S',
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_BOLSA PRIMARY KEY (UID_BOLSA),
    CONSTRAINT FK_BOLSA_FINANCIAMENTO FOREIGN KEY (UID_FINANCIAMENTO) 
        REFERENCES TB_FINANCIAMENTO(UID_FINANCIAMENTO),
    CONSTRAINT FK_BOLSA_BOLSISTA FOREIGN KEY (UID_BOLSISTA) 
        REFERENCES TB_PESSOA(UID_PESSOA),
    CONSTRAINT FK_BOLSA_TIPO FOREIGN KEY (CODE_TIPO_BOLSA) 
        REFERENCES DM_TIPO_BOLSA(CODE_TIPO_BOLSA),
    CONSTRAINT FK_BOLSA_SITUACAO FOREIGN KEY (CODE_SITUACAO) 
        REFERENCES DM_SITUACAO_FINANCIAMENTO(CODE_SITUACAO),
    CONSTRAINT CK_BOLSA_ATIVO CHECK (ST_REGISTRO_ATIVO IN ('S', 'N')),
    CONSTRAINT CK_BOLSA_DATAS CHECK (
        DATE_INICIO <= DATE_FIM OR DATE_FIM IS NULL
    )
);

CREATE TABLE TB_VEICULO_PUBLICACAO (
    UID_VEICULO VARCHAR(36) NOT NULL,
    NM_VEICULO VARCHAR(200) NOT NULL,
    CODE_TIPO_VEICULO CHAR(2) NOT NULL,
    NM_ISSN_ISBN VARCHAR(20),
    UID_EDITORA VARCHAR(36),
    NM_QUALIS VARCHAR(5),
    CNT_FATOR_IMPACTO DECIMAL(10,3),
    NM_PAIS_PUBLICACAO VARCHAR(60),
    CODE_IDIOMA CHAR(2) NOT NULL,
    ST_REGISTRO_ATIVO CHAR(1) DEFAULT 'S',
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_VEICULO PRIMARY KEY (UID_VEICULO),
    CONSTRAINT FK_VEICULO_TIPO FOREIGN KEY (CODE_TIPO_VEICULO) 
        REFERENCES DM_TIPO_VEICULO(CODE_TIPO_VEICULO),
    CONSTRAINT FK_VEICULO_EDITORA FOREIGN KEY (UID_EDITORA) 
        REFERENCES TB_INSTITUICAO(UID_INSTITUICAO),
    CONSTRAINT FK_VEICULO_IDIOMA FOREIGN KEY (CODE_IDIOMA) 
        REFERENCES DM_IDIOMA(CODE_IDIOMA),
    CONSTRAINT CK_VEICULO_ATIVO CHECK (ST_REGISTRO_ATIVO IN ('S', 'N'))
);

CREATE TABLE TB_PUBLICACAO (
    UID_PUBLICACAO VARCHAR(36) NOT NULL,
    CODE_TIPO_PUBLICACAO CHAR(2) NOT NULL,
    NM_TITULO VARCHAR(500) NOT NULL,
    NM_RESUMO VARCHAR(4000),
    NM_PALAVRAS_CHAVE VARCHAR(500),
    DATE_PUBLICACAO DATE NOT NULL,
    UID_VEICULO VARCHAR(36) NOT NULL,
    NM_VOLUME VARCHAR(20),
    NM_NUMERO VARCHAR(20),
    NM_PAGINA_INICIAL VARCHAR(10),
    NM_PAGINA_FINAL VARCHAR(10),
    NM_DOI VARCHAR(100),
    CNT_CITACOES INTEGER DEFAULT 0,
    FLAG_REVISAO_PARES CHAR(1) DEFAULT 'N',
    ST_REGISTRO_ATIVO CHAR(1) DEFAULT 'S',
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_PUBLICACAO PRIMARY KEY (UID_PUBLICACAO),
    CONSTRAINT FK_PUBLICACAO_TIPO FOREIGN KEY (CODE_TIPO_PUBLICACAO) 
        REFERENCES DM_TIPO_PUBLICACAO(CODE_TIPO_PUBLICACAO),
    CONSTRAINT FK_PUBLICACAO_VEICULO FOREIGN KEY (UID_VEICULO) 
        REFERENCES TB_VEICULO_PUBLICACAO(UID_VEICULO),
    CONSTRAINT CK_PUBLICACAO_ATIVO CHECK (ST_REGISTRO_ATIVO IN ('S', 'N')),
    CONSTRAINT CK_PUBLICACAO_REVISAO_PARES CHECK (FLAG_REVISAO_PARES IN ('S', 'N'))
);

CREATE TABLE RT_AUTOR_PUBLICACAO (
    UID_AUTOR_PUBLICACAO VARCHAR(36) NOT NULL,
    UID_PUBLICACAO VARCHAR(36) NOT NULL,
    UID_PESSOA VARCHAR(36) NOT NULL,
    CNT_ORDEM_AUTORIA INTEGER NOT NULL,
    FLAG_AUTOR_CORRESPONDENTE CHAR(1) DEFAULT 'N',
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_AUTOR_PUBLICACAO PRIMARY KEY (UID_AUTOR_PUBLICACAO),
    CONSTRAINT FK_AUTOR_PUBLICACAO_PUBLICACAO FOREIGN KEY (UID_PUBLICACAO) 
        REFERENCES TB_PUBLICACAO(UID_PUBLICACAO),
    CONSTRAINT FK_AUTOR_PUBLICACAO_PESSOA FOREIGN KEY (UID_PESSOA) 
        REFERENCES TB_PESSOA(UID_PESSOA),
    CONSTRAINT CK_AUTOR_PUBLICACAO_CORRESPONDENTE CHECK (FLAG_AUTOR_CORRESPONDENTE IN ('S', 'N')),
    CONSTRAINT UK_AUTOR_PUBLICACAO UNIQUE (UID_PUBLICACAO, UID_PESSOA)
);

CREATE TABLE RT_PROJETO_PUBLICACAO (
    UID_PROJETO_PUBLICACAO VARCHAR(36) NOT NULL,
    UID_PROJETO VARCHAR(36) NOT NULL,
    UID_PUBLICACAO VARCHAR(36) NOT NULL,
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_PROJETO_PUBLICACAO PRIMARY KEY (UID_PROJETO_PUBLICACAO),
    CONSTRAINT FK_PROJETO_PUBLICACAO_PROJETO FOREIGN KEY (UID_PROJETO) 
        REFERENCES TB_PROJETO(UID_PROJETO),
    CONSTRAINT FK_PROJETO_PUBLICACAO_PUBLICACAO FOREIGN KEY (UID_PUBLICACAO) 
        REFERENCES TB_PUBLICACAO(UID_PUBLICACAO),
    CONSTRAINT UK_PROJETO_PUBLICACAO UNIQUE (UID_PROJETO, UID_PUBLICACAO)
);

CREATE TABLE RT_ORIENTACAO_PUBLICACAO (
    UID_ORIENTACAO_PUBLICACAO VARCHAR(36) NOT NULL,
    UID_ORIENTACAO VARCHAR(36) NOT NULL,
    UID_PUBLICACAO VARCHAR(36) NOT NULL,
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_ORIENTACAO_PUBLICACAO PRIMARY KEY (UID_ORIENTACAO_PUBLICACAO),
    CONSTRAINT FK_ORIENTACAO_PUBLICACAO_ORIENTACAO FOREIGN KEY (UID_ORIENTACAO) 
        REFERENCES TB_ORIENTACAO(UID_ORIENTACAO),
    CONSTRAINT FK_ORIENTACAO_PUBLICACAO_PUBLICACAO FOREIGN KEY (UID_PUBLICACAO) 
        REFERENCES TB_PUBLICACAO(UID_PUBLICACAO),
    CONSTRAINT UK_ORIENTACAO_PUBLICACAO UNIQUE (UID_ORIENTACAO, UID_PUBLICACAO)
);

CREATE TABLE TB_EVENTO (
    UID_EVENTO VARCHAR(36) NOT NULL,
    NM_EVENTO VARCHAR(200) NOT NULL,
    NM_SIGLA VARCHAR(30),
    CODE_TIPO_EVENTO CHAR(2) NOT NULL,
    DATE_INICIO DATE NOT NULL,
    DATE_FIM DATE NOT NULL,
    NM_LOCAL VARCHAR(100),
    NM_CIDADE VARCHAR(50),
    CODE_PAIS CHAR(3) NOT NULL,
    UID_INSTITUICAO_ORGANIZADORA VARCHAR(36),
    NM_SITE VARCHAR(100),
    NM_AMBITO VARCHAR(30),
    ST_REGISTRO_ATIVO CHAR(1) DEFAULT 'S',
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_EVENTO PRIMARY KEY (UID_EVENTO),
    CONSTRAINT FK_EVENTO_TIPO FOREIGN KEY (CODE_TIPO_EVENTO) 
        REFERENCES DM_TIPO_EVENTO(CODE_TIPO_EVENTO),
    CONSTRAINT FK_EVENTO_PAIS FOREIGN KEY (CODE_PAIS) 
        REFERENCES DM_PAIS(CODE_PAIS),
    CONSTRAINT FK_EVENTO_INSTITUICAO FOREIGN KEY (UID_INSTITUICAO_ORGANIZADORA) 
        REFERENCES TB_INSTITUICAO(UID_INSTITUICAO),
    CONSTRAINT CK_EVENTO_ATIVO CHECK (ST_REGISTRO_ATIVO IN ('S', 'N')),
    CONSTRAINT CK_EVENTO_DATAS CHECK (DATE_INICIO <= DATE_FIM)
);

CREATE TABLE TB_PARTICIPACAO_EVENTO (
    UID_PARTICIPACAO VARCHAR(36) NOT NULL,
    UID_PESSOA VARCHAR(36) NOT NULL,
    UID_EVENTO VARCHAR(36) NOT NULL,
    CODE_TIPO_PARTICIPACAO CHAR(2) NOT NULL,
    UID_PUBLICACAO VARCHAR(36),
    FLAG_APRESENTACAO_ORAL CHAR(1) DEFAULT 'N',
    FLAG_CERTIFICADO CHAR(1) DEFAULT 'N',
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_PARTICIPACAO_EVENTO PRIMARY KEY (UID_PARTICIPACAO),
    CONSTRAINT FK_PARTICIPACAO_PESSOA FOREIGN KEY (UID_PESSOA) 
        REFERENCES TB_PESSOA(UID_PESSOA),
    CONSTRAINT FK_PARTICIPACAO_EVENTO FOREIGN KEY (UID_EVENTO) 
        REFERENCES TB_EVENTO(UID_EVENTO),
    CONSTRAINT FK_PARTICIPACAO_TIPO FOREIGN KEY (CODE_TIPO_PARTICIPACAO) 
        REFERENCES DM_TIPO_PARTICIPACAO(CODE_TIPO_PARTICIPACAO),
    CONSTRAINT FK_PARTICIPACAO_PUBLICACAO FOREIGN KEY (UID_PUBLICACAO) 
        REFERENCES TB_PUBLICACAO(UID_PUBLICACAO),
    CONSTRAINT CK_PARTICIPACAO_APRESENTACAO CHECK (FLAG_APRESENTACAO_ORAL IN ('S', 'N')),
    CONSTRAINT CK_PARTICIPACAO_CERTIFICADO CHECK (FLAG_CERTIFICADO IN ('S', 'N'))
);

CREATE TABLE TB_FINANCIAMENTO_PARTICIPACAO (
    UID_FINANCIAMENTO_PART VARCHAR(36) NOT NULL,
    UID_PARTICIPACAO VARCHAR(36) NOT NULL,
    UID_FINANCIAMENTO VARCHAR(36),
    CNT_VALOR DECIMAL(10,2) NOT NULL,
    CODE_MOEDA CHAR(3) NOT NULL,
    CODE_TIPO_DESPESA CHAR(2) NOT NULL,
    AU_DT_CADASTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AU_DT_ATUALIZACAO TIMESTAMP,
    AU_DS_USUARIO VARCHAR(30),
    CONSTRAINT PK_FINANCIAMENTO_PART PRIMARY KEY (UID_FINANCIAMENTO_PART),
    CONSTRAINT FK_FINANCIAMENTO_PART_PARTICIPACAO FOREIGN KEY (UID_PARTICIPACAO) 
        REFERENCES TB_PARTICIPACAO_EVENTO(UID_PARTICIPACAO),
    CONSTRAINT FK_FINANCIAMENTO_PART_FINANCIAMENTO FOREIGN KEY (UID_FINANCIAMENTO) 
        REFERENCES TB_FINANCIAMENTO(UID_FINANCIAMENTO),
    CONSTRAINT FK_FINANCIAMENTO_PART_MOEDA FOREIGN KEY (CODE_MOEDA) 
        REFERENCES DM_MOEDA(CODE_MOEDA),
    CONSTRAINT FK_FINANCIAMENTO_PART_TIPO_DESPESA FOREIGN KEY (CODE_TIPO_DESPESA) 
        REFERENCES DM_TIPO_DESPESA(CODE_TIPO_DESPESA)
);

-- Tabelas de auditoria

CREATE TABLE AU_PESSOA (
    UID_PESSOA VARCHAR(36) NOT NULL,
    CODE_TIPO_PESSOA CHAR(2) NOT NULL,
    NM_PESSOA VARCHAR(100) NOT NULL,
    DATE_NASCIMENTO DATE,
    CODE_NACIONALIDADE CHAR(3),
    NM_EMAIL VARCHAR(100),
    NM_TELEFONE VARCHAR(20),
    FLAG_ATIVO CHAR(1),
    AU_DT_OPERACAO TIMESTAMP NOT NULL,
    AU_TP_OPERACAO CHAR(1) NOT NULL,
    AU_DS_USUARIO_SESSAO VARCHAR(30),
    AU_NU_IP_SESSAO VARCHAR(15),
    AU_DS_USUARIO_APLICACAO VARCHAR(30)
);

CREATE TABLE AU_PROFESSOR (
    UID_PESSOA VARCHAR(36) NOT NULL,
    CODE_TITULACAO CHAR(2) NOT NULL,
    NM_FUNCIONAL VARCHAR(20),
    DATE_CONTRATACAO DATE,
    UID_DEPARTAMENTO VARCHAR(36) NOT NULL,
    CODE_REGIME_TRABALHO CHAR(2) NOT NULL,
    NM_CURRICULO_LATTES VARCHAR(100),
    NM_ORCID VARCHAR(50),
    ST_REGISTRO_ATIVO CHAR(1),
    AU_DT_OPERACAO TIMESTAMP NOT NULL,
    AU_TP_OPERACAO CHAR(1) NOT NULL,
    AU_DS_USUARIO_SESSAO VARCHAR(30),
    AU_NU_IP_SESSAO VARCHAR(15),
    AU_DS_USUARIO_APLICACAO VARCHAR(30)
);

CREATE TABLE AU_ESTUDANTE (
    UID_PESSOA VARCHAR(36) NOT NULL,
    NM_MATRICULA VARCHAR(20) NOT NULL,
    CODE_NIVEL_CURSO CHAR(2) NOT NULL,
    DATE_INGRESSO DATE NOT NULL,
    DATE_CONCLUSAO_PREVISTA DATE,
    UID_CURSO VARCHAR(36) NOT NULL,
    FLAG_BOLSISTA CHAR(1),
    ST_REGISTRO_ATIVO CHAR(1),
    AU_DT_OPERACAO TIMESTAMP NOT NULL,
    AU_TP_OPERACAO CHAR(1) NOT NULL,
    AU_DS_USUARIO_SESSAO VARCHAR(30),
    AU_NU_IP_SESSAO VARCHAR(15),
    AU_DS_USUARIO_APLICACAO VARCHAR(30)
);

CREATE TABLE AU_GRUPO_PESQUISA (
    UID_GRUPO VARCHAR(36) NOT NULL,
    NM_GRUPO VARCHAR(100) NOT NULL,
    NM_DESCRICAO VARCHAR(4000),
    DATE_CRIACAO DATE NOT NULL,
    UID_LIDER VARCHAR(36) NOT NULL,
    UID_INSTITUICAO VARCHAR(36) NOT NULL,
    NM_SITE VARCHAR(100),
    CODE_SITUACAO CHAR(2) NOT NULL,
    NM_CERTIFICACAO_CNPQ VARCHAR(50),
    ST_REGISTRO_ATIVO CHAR(1),
    AU_DT_OPERACAO TIMESTAMP NOT NULL,
    AU_TP_OPERACAO CHAR(1) NOT NULL,
    AU_DS_USUARIO_SESSAO VARCHAR(30),
    AU_NU_IP_SESSAO VARCHAR(15),
    AU_DS_USUARIO_APLICACAO VARCHAR(30)
);

CREATE TABLE AU_ORIENTACAO (
    UID_ORIENTACAO VARCHAR(36) NOT NULL,
    UID_ORIENTADOR VARCHAR(36) NOT NULL,
    UID_ORIENTANDO VARCHAR(36) NOT NULL,
    UID_PROJETO VARCHAR(36),
    CODE_TIPO_ORIENTACAO CHAR(2) NOT NULL,
    NM_TITULO VARCHAR(200) NOT NULL,
    NM_DESCRICAO VARCHAR(4000),
    DATE_INICIO DATE NOT NULL,
    DATE_FIM_PREVISTO DATE,
    DATE_FIM_REAL DATE,
    CODE_SITUACAO CHAR(2) NOT NULL,
    DATE_QUALIFICACAO DATE,
    DATE_DEFESA DATE,
    ST_REGISTRO_ATIVO CHAR(1),
    AU_DT_OPERACAO TIMESTAMP NOT NULL,
    AU_TP_OPERACAO CHAR(1) NOT NULL,
    AU_DS_USUARIO_SESSAO VARCHAR(30),
    AU_NU_IP_SESSAO VARCHAR(15),
    AU_DS_USUARIO_APLICACAO VARCHAR(30)
);

-- Criação de índices 

-- Índices para TB_PESSOA
CREATE INDEX IDX_PESSOA_NOME ON TB_PESSOA(NM_PESSOA);
CREATE INDEX IDX_PESSOA_TIPO ON TB_PESSOA(CODE_TIPO_PESSOA);

-- Índices para TB_PROFESSOR
CREATE INDEX IDX_PROFESSOR_DEPARTAMENTO ON TB_PROFESSOR(UID_DEPARTAMENTO);
CREATE INDEX IDX_PROFESSOR_TITULACAO ON TB_PROFESSOR(CODE_TITULACAO);

-- Índices para TB_ESTUDANTE
CREATE INDEX IDX_ESTUDANTE_CURSO ON TB_ESTUDANTE(UID_CURSO);
CREATE INDEX IDX_ESTUDANTE_NIVEL ON TB_ESTUDANTE(CODE_NIVEL_CURSO);
CREATE INDEX IDX_ESTUDANTE_BOLSISTA ON TB_ESTUDANTE(FLAG_BOLSISTA) WHERE FLAG_BOLSISTA = 'S';

-- Índices para TB_ORIENTACAO
CREATE INDEX IDX_ORIENTACAO_ORIENTADOR ON TB_ORIENTACAO(UID_ORIENTADOR);
CREATE INDEX IDX_ORIENTACAO_ORIENTANDO ON TB_ORIENTACAO(UID_ORIENTANDO);
CREATE INDEX IDX_ORIENTACAO_TIPO ON TB_ORIENTACAO(CODE_TIPO_ORIENTACAO);
CREATE INDEX IDX_ORIENTACAO_SITUACAO ON TB_ORIENTACAO(CODE_SITUACAO);
CREATE INDEX IDX_ORIENTACAO_DATAS ON TB_ORIENTACAO(DATE_INICIO, DATE_FIM_PREVISTO);

-- Índices para TB_GRUPO_PESQUISA
CREATE INDEX IDX_GRUPO_LIDER ON TB_GRUPO_PESQUISA(UID_LIDER);
CREATE INDEX IDX_GRUPO_INSTITUICAO ON TB_GRUPO_PESQUISA(UID_INSTITUICAO);
CREATE INDEX IDX_GRUPO_SITUACAO ON TB_GRUPO_PESQUISA(CODE_SITUACAO);

-- Índices para TB_PROJETO
CREATE INDEX IDX_PROJETO_COORDENADOR ON TB_PROJETO(UID_COORDENADOR);
CREATE INDEX IDX_PROJETO_GRUPO ON TB_PROJETO(UID_GRUPO);
CREATE INDEX IDX_PROJETO_LINHA ON TB_PROJETO(UID_LINHA);
CREATE INDEX IDX_PROJETO_SITUACAO ON TB_PROJETO(CODE_SITUACAO);
CREATE INDEX IDX_PROJETO_DATAS ON TB_PROJETO(DATE_INICIO, DATE_FIM_PREVISTO);

-- Índices para TB_PUBLICACAO
CREATE INDEX IDX_PUBLICACAO_TIPO ON TB_PUBLICACAO(CODE_TIPO_PUBLICACAO);
CREATE INDEX IDX_PUBLICACAO_VEICULO ON TB_PUBLICACAO(UID_VEICULO);
CREATE INDEX IDX_PUBLICACAO_DATA ON TB_PUBLICACAO(DATE_PUBLICACAO);
CREATE INDEX IDX_PUBLICACAO_CITACOES ON TB_PUBLICACAO(CNT_CITACOES);

-- Índices para RT_AUTOR_PUBLICACAO
CREATE INDEX IDX_AUTOR_PUBLICACAO ON RT_AUTOR_PUBLICACAO(UID_PUBLICACAO);
CREATE INDEX IDX_AUTOR_PESSOA ON RT_AUTOR_PUBLICACAO(UID_PESSOA);

-- Índices para RT_MEMBRO_GRUPO
CREATE INDEX IDX_MEMBRO_GRUPO_GRUPO ON RT_MEMBRO_GRUPO(UID_GRUPO);
CREATE INDEX IDX_MEMBRO_GRUPO_PESSOA ON RT_MEMBRO_GRUPO(UID_PESSOA);
CREATE INDEX IDX_MEMBRO_GRUPO_PAPEL ON RT_MEMBRO_GRUPO(CODE_PAPEL);
CREATE INDEX IDX_MEMBRO_GRUPO_ATIVO ON RT_MEMBRO_GRUPO(FLAG_ATIVO) WHERE FLAG_ATIVO = 'S';

-- Índices para TB_FINANCIAMENTO
CREATE INDEX IDX_FINANCIAMENTO_PROJETO ON TB_FINANCIAMENTO(UID_PROJETO);
CREATE INDEX IDX_FINANCIAMENTO_ORIENTACAO ON TB_FINANCIAMENTO(UID_ORIENTACAO);
CREATE INDEX IDX_FINANCIAMENTO_INSTITUICAO ON TB_FINANCIAMENTO(UID_INSTITUICAO_FINANCIADORA);
CREATE INDEX IDX_FINANCIAMENTO_SITUACAO ON TB_FINANCIAMENTO(CODE_SITUACAO);
CREATE INDEX IDX_FINANCIAMENTO_TIPO ON TB_FINANCIAMENTO(CODE_TIPO_FINANCIAMENTO);

-- Índices para TB_BOLSA
CREATE INDEX IDX_BOLSA_FINANCIAMENTO ON TB_BOLSA(UID_FINANCIAMENTO);
CREATE INDEX IDX_BOLSA_BOLSISTA ON TB_BOLSA(UID_BOLSISTA);
CREATE INDEX IDX_BOLSA_TIPO ON TB_BOLSA(CODE_TIPO_BOLSA);
CREATE INDEX IDX_BOLSA_SITUACAO ON TB_BOLSA(CODE_SITUACAO);

-- Índices para TB_EVENTO
CREATE INDEX IDX_EVENTO_TIPO ON TB_EVENTO(CODE_TIPO_EVENTO);
CREATE INDEX IDX_EVENTO_PAIS ON TB_EVENTO(CODE_PAIS);
CREATE INDEX IDX_EVENTO_DATA ON TB_EVENTO(DATE_INICIO, DATE_FIM);

-- Índices para TB_PARTICIPACAO_EVENTO
CREATE INDEX IDX_PARTICIPACAO_PESSOA ON TB_PARTICIPACAO_EVENTO(UID_PESSOA);
CREATE INDEX IDX_PARTICIPACAO_EVENTO ON TB_PARTICIPACAO_EVENTO(UID_EVENTO);
CREATE INDEX IDX_PARTICIPACAO_TIPO ON TB_PARTICIPACAO_EVENTO(CODE_TIPO_PARTICIPACAO);
CREATE INDEX IDX_PARTICIPACAO_PUBLICACAO ON TB_PARTICIPACAO_EVENTO(UID_PUBLICACAO);

-- Outros índices úteis para consultas frequentes
CREATE INDEX IDX_PUBLICACAO_PALAVRAS_CHAVE ON TB_PUBLICACAO(NM_PALAVRAS_CHAVE);
CREATE INDEX IDX_LINHA_GRUPO ON TB_LINHA_PESQUISA(UID_GRUPO);
CREATE INDEX IDX_LINHA_PALAVRAS_CHAVE ON TB_LINHA_PESQUISA(NM_PALAVRAS_CHAVE);
CREATE INDEX IDX_VEICULO_QUALIS ON TB_VEICULO_PUBLICACAO(NM_QUALIS);
CREATE INDEX IDX_VEICULO_FATOR_IMPACTO ON TB_VEICULO_PUBLICACAO(CNT_FATOR_IMPACTO);

-- Inserção de dados de domínio básicos

INSERT INTO DM_TIPO_PESSOA (CODE_TIPO_PESSOA, NM_TIPO_PESSOA, NM_DESCRICAO)
VALUES 
('PF', 'PROFESSOR', 'Professor da instituição'),
('ES', 'ESTUDANTE', 'Estudante da instituição'),
('PQ', 'PESQUISADOR', 'Pesquisador sem vínculo docente'),
('CE', 'COLABORADOR EXTERNO', 'Colaborador de outra instituição');

INSERT INTO DM_TITULACAO (CODE_TITULACAO, NM_TITULACAO, NM_DESCRICAO)
VALUES 
('GR', 'GRADUAÇÃO', 'Graduação completa'),
('ES', 'ESPECIALIZAÇÃO', 'Pós-graduação lato sensu'),
('ME', 'MESTRADO', 'Mestrado completo'),
('DO', 'DOUTORADO', 'Doutorado completo'),
('PD', 'PÓS-DOUTORADO', 'Pós-doutorado');

INSERT INTO DM_NIVEL_CURSO (CODE_NIVEL, NM_NIVEL, NM_DESCRICAO)
VALUES 
('IC', 'INICIAÇÃO CIENTÍFICA', 'Pesquisa de graduação'),
('ES', 'ESPECIALIZAÇÃO', 'Pós-graduação lato sensu'),
('ME', 'MESTRADO', 'Pós-graduação stricto sensu - mestrado'),
('DO', 'DOUTORADO', 'Pós-graduação stricto sensu - doutorado'),
('PD', 'PÓS-DOUTORADO', 'Estágio pós-doutoral');

INSERT INTO DM_REGIME_TRABALHO (CODE_REGIME_TRABALHO, NM_REGIME, NM_DESCRICAO)
VALUES 
('20', '20 HORAS', '20 horas semanais'),
('40', '40 HORAS', '40 horas semanais'),
('DE', 'DEDICAÇÃO EXCLUSIVA', 'Dedicação exclusiva');

INSERT INTO DM_TIPO_ORIENTACAO (CODE_TIPO_ORIENTACAO, NM_TIPO, NM_DESCRICAO, CNT_DURACAO_PADRAO_MESES)
VALUES 
('IC', 'INICIAÇÃO CIENTÍFICA', 'Orientação de IC', 12),
('TC', 'TRABALHO DE CONCLUSÃO', 'TCC de graduação', 6),
('ME', 'MESTRADO', 'Dissertação de mestrado', 24),
('DO', 'DOUTORADO', 'Tese de doutorado', 48),
('PD', 'PÓS-DOUTORADO', 'Supervisão de pós-doutorado', 12);

INSERT INTO DM_SITUACAO_PROJETO (CODE_SITUACAO, NM_SITUACAO, NM_DESCRICAO)
VALUES 
('PE', 'EM PLANEJAMENTO', 'Em fase de planejamento'),
('EA', 'EM ANDAMENTO', 'Em execução'),
('CN', 'CONCLUÍDO', 'Finalizado com sucesso'),
('CA', 'CANCELADO', 'Cancelado antes da conclusão'),
('SU', 'SUSPENSO', 'Temporariamente suspenso');

INSERT INTO DM_TIPO_PUBLICACAO (CODE_TIPO_PUBLICACAO, NM_TIPO, NM_DESCRICAO)
VALUES 
('AR', 'ARTIGO', 'Artigo em periódico'),
('CO', 'CONFERÊNCIA', 'Artigo em anais de conferência'),
('LV', 'LIVRO', 'Livro completo'),
('CP', 'CAPÍTULO DE LIVRO', 'Capítulo de livro'),
('PT', 'PATENTE', 'Patente registrada'),
('TC', 'TRABALHO TÉCNICO', 'Relatório ou trabalho técnico');
```


Consultas Intermediarias

## 1. Listar orientações em andamento por professor com contagem de estudantes por nível acadêmico

```sql
SELECT 
    p_orientador.NM_PESSOA AS nome_orientador,
    dto.NM_TIPO AS nivel_orientacao,
    COUNT(o.UID_ORIENTANDO) AS total_orientandos
FROM 
    TB_ORIENTACAO o
JOIN 
    TB_PESSOA p_orientador ON o.UID_ORIENTADOR = p_orientador.UID_PESSOA
JOIN 
    TB_PESSOA p_orientando ON o.UID_ORIENTANDO = p_orientando.UID_PESSOA
JOIN 
    TB_ESTUDANTE e ON o.UID_ORIENTANDO = e.UID_PESSOA
JOIN 
    DM_TIPO_ORIENTACAO dto ON o.CODE_TIPO_ORIENTACAO = dto.CODE_TIPO_ORIENTACAO
WHERE 
    o.CODE_SITUACAO = 'EA' -- Situação 'Em andamento'
    AND o.ST_REGISTRO_ATIVO = 'S'
GROUP BY 
    p_orientador.UID_PESSOA,
    p_orientador.NM_PESSOA,
    o.CODE_TIPO_ORIENTACAO,
    dto.NM_TIPO
ORDER BY 
    p_orientador.NM_PESSOA,
    dto.NM_TIPO;
```

## 2. Recuperar todas as publicações de um grupo de pesquisa por ano, com contagem por tipo

```sql
SELECT 
    EXTRACT(YEAR FROM p.DATE_PUBLICACAO) AS ano_publicacao,
    dtp.NM_TIPO AS tipo_publicacao,
    COUNT(p.UID_PUBLICACAO) AS total_publicacoes
FROM 
    TB_PUBLICACAO p
JOIN 
    RT_AUTOR_PUBLICACAO ap ON p.UID_PUBLICACAO = ap.UID_PUBLICACAO
JOIN 
    RT_MEMBRO_GRUPO mg ON ap.UID_PESSOA = mg.UID_PESSOA
JOIN 
    TB_GRUPO_PESQUISA gp ON mg.UID_GRUPO = gp.UID_GRUPO
JOIN 
    DM_TIPO_PUBLICACAO dtp ON p.CODE_TIPO_PUBLICACAO = dtp.CODE_TIPO_PUBLICACAO
WHERE 
    gp.UID_GRUPO = :grupo_id  -- Parâmetro para ID do grupo
    AND mg.FLAG_ATIVO = 'S'
    AND p.ST_REGISTRO_ATIVO = 'S'
    AND mg.DATE_INICIO <= p.DATE_PUBLICACAO
    AND (mg.DATE_FIM IS NULL OR mg.DATE_FIM >= p.DATE_PUBLICACAO)
GROUP BY 
    EXTRACT(YEAR FROM p.DATE_PUBLICACAO),
    p.CODE_TIPO_PUBLICACAO,
    dtp.NM_TIPO
ORDER BY 
    ano_publicacao DESC,
    tipo_publicacao;
```

## 3. Listar professores e seus índices h baseados nas citações de publicações

```sql
WITH PublicacoesCitacoes AS (
    SELECT 
        prof.UID_PESSOA,
        p.NM_PESSOA,
        pub.UID_PUBLICACAO,
        pub.CNT_CITACOES,
        ROW_NUMBER() OVER (PARTITION BY prof.UID_PESSOA ORDER BY pub.CNT_CITACOES DESC) as rank_citacoes
    FROM 
        TB_PROFESSOR prof
    JOIN 
        TB_PESSOA p ON prof.UID_PESSOA = p.UID_PESSOA
    JOIN 
        RT_AUTOR_PUBLICACAO ap ON prof.UID_PESSOA = ap.UID_PESSOA
    JOIN 
        TB_PUBLICACAO pub ON ap.UID_PUBLICACAO = pub.UID_PUBLICACAO
    WHERE 
        pub.ST_REGISTRO_ATIVO = 'S'
        AND prof.ST_REGISTRO_ATIVO = 'S'
),
IndiceH AS (
    SELECT 
        UID_PESSOA,
        MAX(CASE WHEN rank_citacoes <= CNT_CITACOES THEN rank_citacoes ELSE NULL END) as indice_h
    FROM 
        PublicacoesCitacoes
    GROUP BY 
        UID_PESSOA
)
SELECT 
    p.NM_PESSOA AS nome_professor,
    COALESCE(ih.indice_h, 0) AS indice_h,
    COUNT(DISTINCT pc.UID_PUBLICACAO) AS total_publicacoes,
    SUM(pc.CNT_CITACOES) AS total_citacoes
FROM 
    TB_PROFESSOR prof
JOIN 
    TB_PESSOA p ON prof.UID_PESSOA = p.UID_PESSOA
LEFT JOIN 
    PublicacoesCitacoes pc ON prof.UID_PESSOA = pc.UID_PESSOA
LEFT JOIN 
    IndiceH ih ON prof.UID_PESSOA = ih.UID_PESSOA
WHERE 
    prof.ST_REGISTRO_ATIVO = 'S'
GROUP BY 
    prof.UID_PESSOA,
    p.NM_PESSOA,
    ih.indice_h
ORDER BY 
    indice_h DESC,
    total_citacoes DESC;
```

## 4. Encontrar projetos com mais publicações nos últimos 3 anos

```sql
SELECT 
    proj.NM_PROJETO AS nome_projeto,
    p_coord.NM_PESSOA AS coordenador,
    COUNT(DISTINCT pp.UID_PUBLICACAO) AS total_publicacoes,
    COUNT(DISTINCT CASE 
        WHEN dtp.CODE_TIPO_PUBLICACAO = 'AR' THEN pp.UID_PUBLICACAO 
        ELSE NULL 
    END) AS publicacoes_artigos,
    COUNT(DISTINCT CASE 
        WHEN dtp.CODE_TIPO_PUBLICACAO = 'CO' THEN pp.UID_PUBLICACAO 
        ELSE NULL 
    END) AS publicacoes_conferencias
FROM 
    TB_PROJETO proj
JOIN 
    TB_PESSOA p_coord ON proj.UID_COORDENADOR = p_coord.UID_PESSOA
JOIN 
    RT_PROJETO_PUBLICACAO pp ON proj.UID_PROJETO = pp.UID_PROJETO
JOIN 
    TB_PUBLICACAO pub ON pp.UID_PUBLICACAO = pub.UID_PUBLICACAO
JOIN 
    DM_TIPO_PUBLICACAO dtp ON pub.CODE_TIPO_PUBLICACAO = dtp.CODE_TIPO_PUBLICACAO
WHERE 
    pub.DATE_PUBLICACAO >= CURRENT_DATE - INTERVAL '3 years'
    AND proj.ST_REGISTRO_ATIVO = 'S'
    AND pub.ST_REGISTRO_ATIVO = 'S'
GROUP BY 
    proj.UID_PROJETO,
    proj.NM_PROJETO,
    p_coord.NM_PESSOA
ORDER BY 
    total_publicacoes DESC,
    nome_projeto
LIMIT 10;
```

## 5. Listar estudantes bolsistas e seus orientadores, com detalhes das bolsas

```sql
SELECT 
    pe.NM_PESSOA AS nome_estudante,
    e.NM_MATRICULA AS matricula,
    po.NM_PESSOA AS nome_orientador,
    tb.CNT_VALOR_MENSAL AS valor_bolsa,
    dtb.NM_TIPO AS tipo_bolsa,
    i.NM_INSTITUICAO AS instituicao_financiadora,
    tb.DATE_INICIO AS inicio_bolsa,
    tb.DATE_FIM AS fim_bolsa,
    dsf.NM_SITUACAO AS situacao_bolsa
FROM 
    TB_ESTUDANTE e
JOIN 
    TB_PESSOA pe ON e.UID_PESSOA = pe.UID_PESSOA
JOIN 
    TB_BOLSA tb ON e.UID_PESSOA = tb.UID_BOLSISTA
JOIN 
    TB_FINANCIAMENTO tf ON tb.UID_FINANCIAMENTO = tf.UID_FINANCIAMENTO
JOIN 
    TB_INSTITUICAO i ON tf.UID_INSTITUICAO_FINANCIADORA = i.UID_INSTITUICAO
JOIN 
    DM_TIPO_BOLSA dtb ON tb.CODE_TIPO_BOLSA = dtb.CODE_TIPO_BOLSA
JOIN 
    DM_SITUACAO_FINANCIAMENTO dsf ON tb.CODE_SITUACAO = dsf.CODE_SITUACAO
LEFT JOIN 
    TB_ORIENTACAO o ON e.UID_PESSOA = o.UID_ORIENTANDO AND o.CODE_SITUACAO = 'EA'
LEFT JOIN 
    TB_PROFESSOR prof ON o.UID_ORIENTADOR = prof.UID_PESSOA
LEFT JOIN 
    TB_PESSOA po ON prof.UID_PESSOA = po.UID_PESSOA
WHERE 
    e.FLAG_BOLSISTA = 'S'
    AND e.ST_REGISTRO_ATIVO = 'S'
    AND tb.ST_REGISTRO_ATIVO = 'S'
    AND tb.CODE_SITUACAO = 'EA' -- Assumindo 'EA' para bolsas em andamento
ORDER BY 
    pe.NM_PESSOA,
    tb.DATE_INICIO DESC;
```

## 6. Recuperar eventos com maior participação de membros do departamento

```sql
SELECT 
    e.NM_EVENTO AS nome_evento,
    e.NM_SIGLA AS sigla_evento,
    dte.NM_TIPO AS tipo_evento,
    e.DATE_INICIO AS data_inicio,
    e.DATE_FIM AS data_fim,
    e.NM_CIDADE AS cidade,
    dp.NM_PAIS AS pais,
    COUNT(DISTINCT pe.UID_PARTICIPACAO) AS total_participantes,
    COUNT(DISTINCT CASE 
        WHEN prof.UID_PESSOA IS NOT NULL THEN pe.UID_PARTICIPACAO 
        ELSE NULL 
    END) AS professores,
    COUNT(DISTINCT CASE 
        WHEN est.UID_PESSOA IS NOT NULL THEN pe.UID_PARTICIPACAO 
        ELSE NULL 
    END) AS estudantes,
    COUNT(DISTINCT CASE 
        WHEN dtp.CODE_TIPO_PARTICIPACAO = 'AP' THEN pe.UID_PARTICIPACAO 
        ELSE NULL 
    END) AS apresentadores
FROM 
    TB_EVENTO e
JOIN 
    TB_PARTICIPACAO_EVENTO pe ON e.UID_EVENTO = pe.UID_EVENTO
JOIN 
    TB_PESSOA p ON pe.UID_PESSOA = p.UID_PESSOA
JOIN 
    DM_TIPO_EVENTO dte ON e.CODE_TIPO_EVENTO = dte.CODE_TIPO_EVENTO
JOIN 
    DM_PAIS dp ON e.CODE_PAIS = dp.CODE_PAIS
JOIN 
    DM_TIPO_PARTICIPACAO dtp ON pe.CODE_TIPO_PARTICIPACAO = dtp.CODE_TIPO_PARTICIPACAO
LEFT JOIN 
    TB_PROFESSOR prof ON p.UID_PESSOA = prof.UID_PESSOA AND prof.UID_DEPARTAMENTO = :departamento_id
LEFT JOIN 
    TB_ESTUDANTE est ON p.UID_PESSOA = est.UID_PESSOA
LEFT JOIN 
    TB_CURSO c ON est.UID_CURSO = c.UID_CURSO
LEFT JOIN 
    TB_DEPARTAMENTO d ON c.UID_DEPARTAMENTO = d.UID_DEPARTAMENTO AND d.UID_DEPARTAMENTO = :departamento_id
WHERE 
    e.ST_REGISTRO_ATIVO = 'S'
    AND (prof.UID_PESSOA IS NOT NULL OR d.UID_DEPARTAMENTO IS NOT NULL)
GROUP BY 
    e.UID_EVENTO,
    e.NM_EVENTO,
    e.NM_SIGLA,
    dte.NM_TIPO,
    e.DATE_INICIO,
    e.DATE_FIM,
    e.NM_CIDADE,
    dp.NM_PAIS
ORDER BY 
    total_participantes DESC,
    e.DATE_INICIO DESC
LIMIT 10;
```

## 7. Listar orientações concluídas com tempo médio de conclusão por orientador

```sql
WITH OrientacoesConcluidas AS (
    SELECT 
        o.UID_ORIENTADOR,
        p.NM_PESSOA AS nome_orientador,
        dt.NM_TITULACAO AS titulacao_orientador,
        dto.NM_TIPO AS tipo_orientacao,
        o.DATE_INICIO,
        o.DATE_FIM_REAL,
        EXTRACT(MONTH FROM AGE(o.DATE_FIM_REAL, o.DATE_INICIO)) AS duracao_meses,
        AVG(EXTRACT(MONTH FROM AGE(o.DATE_FIM_REAL, o.DATE_INICIO))) OVER (
            PARTITION BY o.UID_ORIENTADOR, o.CODE_TIPO_ORIENTACAO
            ORDER BY o.DATE_FIM_REAL
            ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
        ) AS media_movel
    FROM 
        TB_ORIENTACAO o
    JOIN 
        TB_PROFESSOR prof ON o.UID_ORIENTADOR = prof.UID_PESSOA
    JOIN 
        TB_PESSOA p ON prof.UID_PESSOA = p.UID_PESSOA
    JOIN 
        DM_TITULACAO dt ON prof.CODE_TITULACAO = dt.CODE_TITULACAO
    JOIN 
        DM_TIPO_ORIENTACAO dto ON o.CODE_TIPO_ORIENTACAO = dto.CODE_TIPO_ORIENTACAO
    WHERE 
        o.CODE_SITUACAO = 'CN' -- Concluído
        AND o.DATE_FIM_REAL IS NOT NULL
        AND o.ST_REGISTRO_ATIVO = 'S'
)
SELECT 
    UID_ORIENTADOR,
    nome_orientador,
    titulacao_orientador,
    tipo_orientacao,
    COUNT(*) AS total_orientacoes,
    ROUND(AVG(duracao_meses), 1) AS media_duracao_meses,
    ROUND(MIN(duracao_meses), 1) AS min_duracao_meses,
    ROUND(MAX(duracao_meses), 1) AS max_duracao_meses,
    ROUND(MAX(media_movel), 1) AS media_movel_atual
FROM 
    OrientacoesConcluidas
GROUP BY 
    UID_ORIENTADOR,
    nome_orientador,
    titulacao_orientador,
    tipo_orientacao
HAVING 
    COUNT(*) >= 3 -- Pelo menos 3 orientações concluídas para ter estatística significativa
ORDER BY 
    nome_orientador,
    tipo_orientacao;
```

## 8. Mostrar grupos de pesquisa com maior número de linhas de pesquisa e membros

```sql
SELECT 
    gp.UID_GRUPO,
    gp.NM_GRUPO AS nome_grupo,
    p.NM_PESSOA AS lider_grupo,
    i.NM_INSTITUICAO AS instituicao,
    dsg.NM_SITUACAO AS situacao_grupo,
    COUNT(DISTINCT lp.UID_LINHA) AS total_linhas_pesquisa,
    COUNT(DISTINCT mg.UID_PESSOA) AS total_membros,
    COUNT(DISTINCT CASE WHEN mg.CODE_PAPEL = 'PF' THEN mg.UID_PESSOA ELSE NULL END) AS professores,
    COUNT(DISTINCT CASE WHEN mg.CODE_PAPEL = 'ES' THEN mg.UID_PESSOA ELSE NULL END) AS estudantes,
    COUNT(DISTINCT CASE WHEN mg.CODE_PAPEL = 'PQ' THEN mg.UID_PESSOA ELSE NULL END) AS pesquisadores,
    COUNT(DISTINCT CASE WHEN mg.CODE_PAPEL = 'CE' THEN mg.UID_PESSOA ELSE NULL END) AS colaboradores_externos
FROM 
    TB_GRUPO_PESQUISA gp
JOIN 
    TB_PESSOA p ON gp.UID_LIDER = p.UID_PESSOA
JOIN 
    TB_INSTITUICAO i ON gp.UID_INSTITUICAO = i.UID_INSTITUICAO
JOIN 
    DM_SITUACAO_GRUPO dsg ON gp.CODE_SITUACAO = dsg.CODE_SITUACAO
LEFT JOIN 
    TB_LINHA_PESQUISA lp ON gp.UID_GRUPO = lp.UID_GRUPO AND lp.ST_REGISTRO_ATIVO = 'S'
LEFT JOIN 
    RT_MEMBRO_GRUPO mg ON gp.UID_GRUPO = mg.UID_GRUPO AND mg.FLAG_ATIVO = 'S'
WHERE 
    gp.ST_REGISTRO_ATIVO = 'S'
GROUP BY 
    gp.UID_GRUPO,
    gp.NM_GRUPO,
    p.NM_PESSOA,
    i.NM_INSTITUICAO,
    dsg.NM_SITUACAO
ORDER BY 
    total_membros DESC,
    total_linhas_pesquisa DESC;
```

## 9. Identificar coautorias mais frequentes em publicações

```sql
WITH Autores AS (
    SELECT 
        ap.UID_PUBLICACAO,
        ap.UID_PESSOA,
        p.NM_PESSOA,
        CASE 
            WHEN prof.UID_PESSOA IS NOT NULL THEN 'Professor'
            WHEN est.UID_PESSOA IS NOT NULL THEN 'Estudante'
            ELSE 'Outro'
        END AS tipo_autor
    FROM 
        RT_AUTOR_PUBLICACAO ap
    JOIN 
        TB_PESSOA p ON ap.UID_PESSOA = p.UID_PESSOA
    LEFT JOIN 
        TB_PROFESSOR prof ON p.UID_PESSOA = prof.UID_PESSOA
    LEFT JOIN 
        TB_ESTUDANTE est ON p.UID_PESSOA = est.UID_PESSOA
),
ParesMembros AS (
    SELECT 
        a1.UID_PESSOA AS autor1_id,
        a1.NM_PESSOA AS autor1_nome,
        a1.tipo_autor AS autor1_tipo,
        a2.UID_PESSOA AS autor2_id,
        a2.NM_PESSOA AS autor2_nome,
        a2.tipo_autor AS autor2_tipo,
        a1.UID_PUBLICACAO
    FROM 
        Autores a1
    JOIN 
        Autores a2 ON a1.UID_PUBLICACAO = a2.UID_PUBLICACAO AND a1.UID_PESSOA < a2.UID_PESSOA
)
SELECT 
    autor1_nome,
    autor1_tipo,
    autor2_nome,
    autor2_tipo,
    COUNT(DISTINCT UID_PUBLICACAO) AS total_coautorias,
    MAX(pub.DATE_PUBLICACAO) AS publicacao_mais_recente
FROM 
    ParesMembros pm
JOIN 
    TB_PUBLICACAO pub ON pm.UID_PUBLICACAO = pub.UID_PUBLICACAO
GROUP BY 
    autor1_id,
    autor1_nome,
    autor1_tipo,
    autor2_id,
    autor2_nome,
    autor2_tipo
HAVING 
    COUNT(DISTINCT UID_PUBLICACAO) >= 3 -- Pelo menos 3 colaborações
ORDER BY 
    total_coautorias DESC,
    autor1_nome,
    autor2_nome
LIMIT 20;
```

## 10. Listar instituições parceiras com maior número de colaborações em publicações e projetos

```sql
WITH InstituicoesParceiras AS (
    -- Colaborações em publicações via coautoria
    SELECT 
        i.UID_INSTITUICAO,
        i.NM_INSTITUICAO,
        p.UID_PUBLICACAO AS entidade_id,
        'Publicação' AS tipo_colaboracao
    FROM 
        TB_PUBLICACAO p
    JOIN 
        RT_AUTOR_PUBLICACAO ap1 ON p.UID_PUBLICACAO = ap1.UID_PUBLICACAO
    JOIN 
        TB_PESSOA pes1 ON ap1.UID_PESSOA = pes1.UID_PESSOA
    JOIN 
        TB_PROFESSOR prof1 ON pes1.UID_PESSOA = prof1.UID_PESSOA
    JOIN 
        TB_DEPARTAMENTO dep1 ON prof1.UID_DEPARTAMENTO = dep1.UID_DEPARTAMENTO
    JOIN 
        TB_INSTITUICAO i_local ON dep1.UID_INSTITUICAO = i_local.UID_INSTITUICAO
    
    JOIN 
        RT_AUTOR_PUBLICACAO ap2 ON p.UID_PUBLICACAO = ap2.UID_PUBLICACAO AND ap1.UID_PESSOA != ap2.UID_PESSOA
    JOIN 
        TB_PESSOA pes2 ON ap2.UID_PESSOA = pes2.UID_PESSOA
    LEFT JOIN 
        TB_PROFESSOR prof2 ON pes2.UID_PESSOA = prof2.UID_PESSOA
    LEFT JOIN 
        TB_DEPARTAMENTO dep2 ON prof2.UID_DEPARTAMENTO = dep2.UID_DEPARTAMENTO
    LEFT JOIN 
        TB_INSTITUICAO i ON dep2.UID_INSTITUICAO = i.UID_INSTITUICAO AND i.UID_INSTITUICAO != i_local.UID_INSTITUICAO
    
    WHERE 
        i.UID_INSTITUICAO IS NOT NULL
        AND p.ST_REGISTRO_ATIVO = 'S'
        AND i_local.UID_INSTITUICAO = :instituicao_local_id  -- Parâmetro para instituição local
    
    UNION ALL
    
    -- Colaborações em projetos via membros externos
    SELECT 
        i.UID_INSTITUICAO,
        i.NM_INSTITUICAO,
        proj.UID_PROJETO AS entidade_id,
        'Projeto' AS tipo_colaboracao
    FROM 
        TB_PROJETO proj
    JOIN 
        RT_MEMBRO_PROJETO mp ON proj.UID_PROJETO = mp.UID_PROJETO
    JOIN 
        TB_PESSOA pes ON mp.UID_PESSOA = pes.UID_PESSOA
    JOIN 
        TB_PROFESSOR prof ON pes.UID_PESSOA = prof.UID_PESSOA
    JOIN 
        TB_DEPARTAMENTO dep ON prof.UID_DEPARTAMENTO = dep.UID_DEPARTAMENTO
    JOIN 
        TB_INSTITUICAO i ON dep.UID_INSTITUICAO = i.UID_INSTITUICAO
    WHERE 
        proj.UID_COORDENADOR IN (
            SELECT prof_local.UID_PESSOA
            FROM TB_PROFESSOR prof_local
            JOIN TB_DEPARTAMENTO dep_local ON prof_local.UID_DEPARTAMENTO = dep_local.UID_DEPARTAMENTO
            WHERE dep_local.UID_INSTITUICAO = :instituicao_local_id
        )
        AND i.UID_INSTITUICAO != :instituicao_local_id
        AND proj.ST_REGISTRO_ATIVO = 'S'
    
    UNION ALL
    
    -- Colaborações em bancas via membros externos
    SELECT 
        i.UID_INSTITUICAO,
        i.NM_INSTITUICAO,
        b.UID_BANCA AS entidade_id,
        'Banca' AS tipo_colaboracao
    FROM 
        TB_BANCA b
    JOIN 
        RT_MEMBRO_BANCA mb ON b.UID_BANCA = mb.UID_BANCA
    JOIN 
        TB_PESSOA pes ON mb.UID_PESSOA = pes.UID_PESSOA
    JOIN 
        TB_INSTITUICAO i ON mb.UID_INSTITUICAO_ORIGEM = i.UID_INSTITUICAO
    WHERE 
        mb.FLAG_EXTERNO = 'S'
        AND b.ST_REGISTRO_ATIVO = 'S'
        AND i.UID_INSTITUICAO != :instituicao_local_id
)
SELECT 
    ip.NM_INSTITUICAO AS instituicao_parceira,
    COUNT(DISTINCT CASE WHEN ip.tipo_colaboracao = 'Publicação' THEN ip.entidade_id ELSE NULL END) AS total_publicacoes,
    COUNT(DISTINCT CASE WHEN ip.tipo_colaboracao = 'Projeto' THEN ip.entidade_id ELSE NULL END) AS total_projetos,
    COUNT(DISTINCT CASE WHEN ip.tipo_colaboracao = 'Banca' THEN ip.entidade_id ELSE NULL END) AS total_bancas,
    COUNT(DISTINCT ip.entidade_id) AS total_colaboracoes
FROM 
    InstituicoesParceiras ip
GROUP BY 
    ip.UID_INSTITUICAO,
    ip.NM_INSTITUICAO
HAVING 
    COUNT(DISTINCT ip.entidade_id) >= 2
ORDER BY 
    total_colaboracoes DESC,
    total_publicacoes DESC,
    total_projetos DESC;
```

Estas consultas SQL abrangem diversos aspectos de gerenciamento acadêmico e de pesquisa, demonstrando a integração de múltiplas tabelas com relacionamentos complexos para extrair informações valiosas sobre orientações, publicações, projetos e colaborações entre pesquisadores e instituições.


Consultas Avançadas

## 1. Identificar redes de colaboração entre pesquisadores baseado em coautorias

```sql
WITH CoAutores AS (
    -- Identificar pares de coautores
    SELECT 
        a1.UID_PESSOA AS autor1,
        a2.UID_PESSOA AS autor2,
        a1.UID_PUBLICACAO
    FROM 
        RT_AUTOR_PUBLICACAO a1
    JOIN 
        RT_AUTOR_PUBLICACAO a2 ON a1.UID_PUBLICACAO = a2.UID_PUBLICACAO
    WHERE 
        a1.UID_PESSOA < a2.UID_PESSOA -- Evitar duplicações
)
SELECT 
    p1.NM_PESSOA AS pesquisador1,
    p2.NM_PESSOA AS pesquisador2,
    COUNT(c.UID_PUBLICACAO) AS frequencia_colaboracao,
    -- Obter informações adicionais sobre as publicações mais recentes em colaboração
    STRING_AGG(DISTINCT pub.NM_TITULO, '; ' ORDER BY pub.DATE_PUBLICACAO DESC) 
        FILTER (WHERE ROW_NUMBER() OVER (PARTITION BY p1.UID_PESSOA, p2.UID_PESSOA 
                                         ORDER BY pub.DATE_PUBLICACAO DESC) <= 3) 
        AS publicacoes_recentes
FROM 
    CoAutores c
JOIN 
    TB_PESSOA p1 ON c.autor1 = p1.UID_PESSOA
JOIN 
    TB_PESSOA p2 ON c.autor2 = p2.UID_PESSOA
JOIN 
    TB_PUBLICACAO pub ON c.UID_PUBLICACAO = pub.UID_PUBLICACAO
GROUP BY 
    p1.UID_PESSOA, p2.UID_PESSOA, p1.NM_PESSOA, p2.NM_PESSOA
HAVING 
    COUNT(c.UID_PUBLICACAO) >= 3 -- Colaboração significativa (3 ou mais publicações)
ORDER BY 
    frequencia_colaboracao DESC, pesquisador1, pesquisador2;
```

## 2. Calcular a produtividade de cada grupo de pesquisa considerando publicações ponderadas pelo Qualis

```sql
WITH PesoQualis AS (
    -- Define pesos para cada classificação Qualis
    SELECT 'A1' AS qualis, 1.0 AS peso
    UNION SELECT 'A2', 0.875
    UNION SELECT 'A3', 0.75
    UNION SELECT 'A4', 0.625
    UNION SELECT 'B1', 0.5
    UNION SELECT 'B2', 0.375
    UNION SELECT 'B3', 0.25
    UNION SELECT 'B4', 0.125
    UNION SELECT 'C', 0
),
PublicacoesGrupo AS (
    -- Relaciona publicações a grupos através de membros-autores
    SELECT 
        g.UID_GRUPO,
        g.NM_GRUPO,
        p.UID_PUBLICACAO,
        p.DATE_PUBLICACAO,
        EXTRACT(YEAR FROM p.DATE_PUBLICACAO) AS ano_publicacao,
        COALESCE(v.NM_QUALIS, 'C') AS qualis, -- Default para 'C' se NULL
        COALESCE(pq.peso, 0) AS peso_qualis -- Default para 0 se NULL
    FROM 
        TB_GRUPO_PESQUISA g
    JOIN 
        RT_MEMBRO_GRUPO mg ON g.UID_GRUPO = mg.UID_GRUPO
    JOIN 
        RT_AUTOR_PUBLICACAO ap ON mg.UID_PESSOA = ap.UID_PESSOA
    JOIN 
        TB_PUBLICACAO p ON ap.UID_PUBLICACAO = p.UID_PUBLICACAO
    JOIN 
        TB_VEICULO_PUBLICACAO v ON p.UID_VEICULO = v.UID_VEICULO
    LEFT JOIN 
        PesoQualis pq ON v.NM_QUALIS = pq.qualis
    WHERE 
        mg.FLAG_ATIVO = 'S' AND 
        p.ST_REGISTRO_ATIVO = 'S' AND
        mg.DATE_INICIO <= p.DATE_PUBLICACAO AND 
        (mg.DATE_FIM IS NULL OR mg.DATE_FIM >= p.DATE_PUBLICACAO) -- Publicação dentro do período como membro
)
SELECT 
    pg.UID_GRUPO,
    pg.NM_GRUPO,
    pg.ano_publicacao,
    COUNT(DISTINCT pg.UID_PUBLICACAO) AS total_publicacoes,
    SUM(pg.peso_qualis) AS pontuacao_ponderada,
    ROUND(SUM(pg.peso_qualis) / COUNT(DISTINCT pg.UID_PUBLICACAO), 3) AS media_qualidade,
    -- Análise de tendência usando média móvel de 3 anos
    ROUND(AVG(SUM(pg.peso_qualis)) OVER (
        PARTITION BY pg.UID_GRUPO 
        ORDER BY pg.ano_publicacao 
        ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
    ), 3) AS media_movel_3anos
FROM 
    PublicacoesGrupo pg
GROUP BY 
    pg.UID_GRUPO, pg.NM_GRUPO, pg.ano_publicacao
ORDER BY 
    pg.NM_GRUPO, pg.ano_publicacao;
```

## 3. Analisar a evolução do número de orientações concluídas por programa ao longo dos anos

```sql
WITH OrientacoesConcluidas AS (
    -- Orienta
    SELECT 
        o.UID_ORIENTACAO,
        o.CODE_TIPO_ORIENTACAO,
        to.NM_TIPO AS tipo_orientacao,
        c.UID_CURSO,
        c.NM_CURSO,
        d.UID_DEPARTAMENTO,
        d.NM_DEPARTAMENTO,
        i.NM_INSTITUICAO,
        EXTRACT(YEAR FROM o.DATE_FIM_REAL) AS ano_conclusao
    FROM 
        TB_ORIENTACAO o
    JOIN 
        DM_TIPO_ORIENTACAO to ON o.CODE_TIPO_ORIENTACAO = to.CODE_TIPO_ORIENTACAO
    JOIN 
        TB_ESTUDANTE e ON o.UID_ORIENTANDO = e.UID_PESSOA
    JOIN 
        TB_CURSO c ON e.UID_CURSO = c.UID_CURSO
    JOIN 
        TB_DEPARTAMENTO d ON c.UID_DEPARTAMENTO = d.UID_DEPARTAMENTO
    JOIN 
        TB_INSTITUICAO i ON d.UID_INSTITUICAO = i.UID_INSTITUICAO
    WHERE 
        o.DATE_FIM_REAL IS NOT NULL AND
        o.CODE_SITUACAO = 'CN' -- Concluída
)
SELECT 
    oc.NM_INSTITUICAO,
    oc.NM_DEPARTAMENTO,
    oc.NM_CURSO,
    oc.tipo_orientacao,
    oc.ano_conclusao,
    COUNT(oc.UID_ORIENTACAO) AS total_orientacoes,
    -- Taxa de crescimento em relação ao ano anterior
    CASE 
        WHEN LAG(COUNT(oc.UID_ORIENTACAO)) OVER (
            PARTITION BY oc.UID_CURSO, oc.CODE_TIPO_ORIENTACAO 
            ORDER BY oc.ano_conclusao
        ) = 0 THEN NULL
        ELSE ROUND(
            (COUNT(oc.UID_ORIENTACAO) - LAG(COUNT(oc.UID_ORIENTACAO)) OVER (
                PARTITION BY oc.UID_CURSO, oc.CODE_TIPO_ORIENTACAO 
                ORDER BY oc.ano_conclusao
            )) * 100.0 / LAG(COUNT(oc.UID_ORIENTACAO)) OVER (
                PARTITION BY oc.UID_CURSO, oc.CODE_TIPO_ORIENTACAO 
                ORDER BY oc.ano_conclusao
            ), 2
        )
    END AS taxa_crescimento_percentual,
    -- Média móvel para suavizar flutuações
    ROUND(AVG(COUNT(oc.UID_ORIENTACAO)) OVER (
        PARTITION BY oc.UID_CURSO, oc.CODE_TIPO_ORIENTACAO 
        ORDER BY oc.ano_conclusao 
        ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
    ), 2) AS media_movel_3anos
FROM 
    OrientacoesConcluidas oc
GROUP BY 
    oc.NM_INSTITUICAO, oc.NM_DEPARTAMENTO, oc.UID_CURSO, oc.NM_CURSO, 
    oc.CODE_TIPO_ORIENTACAO, oc.tipo_orientacao, oc.ano_conclusao
ORDER BY 
    oc.NM_INSTITUICAO, oc.NM_DEPARTAMENTO, oc.NM_CURSO, oc.tipo_orientacao, oc.ano_conclusao;
```

## 4. Identificar os projetos mais eficientes em termos de publicações por financiamento recebido

```sql
WITH FinanciamentoProjeto AS (
    -- Calcula o financiamento total por projeto
    SELECT 
        f.UID_PROJETO,
        SUM(f.CNT_VALOR_TOTAL) AS valor_total,
        -- Converter diferentes moedas para uma moeda base (ex: BRL)
        CASE 
            WHEN f.CODE_MOEDA = 'USD' THEN SUM(f.CNT_VALOR_TOTAL * 5.0) -- Taxa de câmbio hipotética
            WHEN f.CODE_MOEDA = 'EUR' THEN SUM(f.CNT_VALOR_TOTAL * 5.5) -- Taxa de câmbio hipotética
            ELSE SUM(f.CNT_VALOR_TOTAL)
        END AS valor_padronizado_BRL
    FROM 
        TB_FINANCIAMENTO f
    WHERE 
        f.ST_REGISTRO_ATIVO = 'S' AND
        f.UID_PROJETO IS NOT NULL
    GROUP BY 
        f.UID_PROJETO, f.CODE_MOEDA
),
PublicacoesProjeto AS (
    -- Conta publicações por projeto
    SELECT 
        pp.UID_PROJETO,
        COUNT(DISTINCT pp.UID_PUBLICACAO) AS total_publicacoes,
        -- Contar publicações de alto impacto (Qualis A)
        COUNT(DISTINCT pp.UID_PUBLICACAO) FILTER (
            WHERE vp.NM_QUALIS IN ('A1', 'A2', 'A3', 'A4')
        ) AS publicacoes_alto_impacto
    FROM 
        RT_PROJETO_PUBLICACAO pp
    JOIN 
        TB_PUBLICACAO p ON pp.UID_PUBLICACAO = p.UID_PUBLICACAO
    JOIN 
        TB_VEICULO_PUBLICACAO vp ON p.UID_VEICULO = vp.UID_VEICULO
    WHERE 
        p.ST_REGISTRO_ATIVO = 'S'
    GROUP BY 
        pp.UID_PROJETO
)
SELECT 
    p.UID_PROJETO,
    p.NM_PROJETO,
    sp.NM_SITUACAO AS situacao_projeto,
    pp.total_publicacoes,
    pp.publicacoes_alto_impacto,
    fp.valor_padronizado_BRL AS financiamento_total_BRL,
    -- Cálculo de eficiência: publicações por 100 mil unidades monetárias
    CASE 
        WHEN fp.valor_padronizado_BRL = 0 OR fp.valor_padronizado_BRL IS NULL THEN NULL
        ELSE ROUND((pp.total_publicacoes::DECIMAL / fp.valor_padronizado_BRL) * 100000, 2)
    END AS publicacoes_por_100k,
    -- Cálculo de eficiência para publicações de alto impacto
    CASE 
        WHEN fp.valor_padronizado_BRL = 0 OR fp.valor_padronizado_BRL IS NULL THEN NULL
        ELSE ROUND((pp.publicacoes_alto_impacto::DECIMAL / fp.valor_padronizado_BRL) * 100000, 2)
    END AS publicacoes_alto_impacto_por_100k
FROM 
    TB_PROJETO p
LEFT JOIN 
    FinanciamentoProjeto fp ON p.UID_PROJETO = fp.UID_PROJETO
LEFT JOIN 
    PublicacoesProjeto pp ON p.UID_PROJETO = pp.UID_PROJETO
JOIN 
    DM_SITUACAO_PROJETO sp ON p.CODE_SITUACAO = sp.CODE_SITUACAO
WHERE 
    p.ST_REGISTRO_ATIVO = 'S' AND
    (fp.valor_padronizado_BRL > 0 OR pp.total_publicacoes > 0) -- Projetos com financiamento ou publicações
ORDER BY 
    CASE 
        WHEN fp.valor_padronizado_BRL = 0 OR fp.valor_padronizado_BRL IS NULL THEN 0
        ELSE (pp.total_publicacoes::DECIMAL / fp.valor_padronizado_BRL)
    END DESC;
```

## 5. Calcular o tempo médio entre qualificação e defesa por orientador e programa

```sql
WITH TempoQualificacaoDefesa AS (
    -- Calcula o tempo entre qualificação e defesa
    SELECT 
        o.UID_ORIENTACAO,
        o.UID_ORIENTADOR,
        p.NM_PESSOA AS orientador,
        prof.CODE_TITULACAO,
        tit.NM_TITULACAO,
        o.CODE_TIPO_ORIENTACAO,
        to.NM_TIPO AS tipo_orientacao,
        c.UID_CURSO,
        c.NM_CURSO,
        d.NM_DEPARTAMENTO,
        o.DATE_QUALIFICACAO,
        o.DATE_DEFESA,
        -- Calcula dias entre qualificação e defesa
        (o.DATE_DEFESA - o.DATE_QUALIFICACAO) AS dias_entre_qual_defesa,
        EXTRACT(MONTH FROM AGE(o.DATE_DEFESA, o.DATE_QUALIFICACAO)) + 
        EXTRACT(YEAR FROM AGE(o.DATE_DEFESA, o.DATE_QUALIFICACAO)) * 12 AS meses_entre_qual_defesa
    FROM 
        TB_ORIENTACAO o
    JOIN 
        TB_PESSOA p ON o.UID_ORIENTADOR = p.UID_PESSOA
    JOIN 
        TB_PROFESSOR prof ON o.UID_ORIENTADOR = prof.UID_PESSOA
    JOIN 
        DM_TITULACAO tit ON prof.CODE_TITULACAO = tit.CODE_TITULACAO
    JOIN 
        DM_TIPO_ORIENTACAO to ON o.CODE_TIPO_ORIENTACAO = to.CODE_TIPO_ORIENTACAO
    JOIN 
        TB_ESTUDANTE e ON o.UID_ORIENTANDO = e.UID_PESSOA
    JOIN 
        TB_CURSO c ON e.UID_CURSO = c.UID_CURSO
    JOIN 
        TB_DEPARTAMENTO d ON c.UID_DEPARTAMENTO = d.UID_DEPARTAMENTO
    WHERE 
        o.DATE_QUALIFICACAO IS NOT NULL AND
        o.DATE_DEFESA IS NOT NULL AND
        o.CODE_SITUACAO = 'CN' -- Concluída
)
SELECT 
    tqd.orientador,
    tqd.NM_TITULACAO AS titulacao_orientador,
    tqd.NM_DEPARTAMENTO AS departamento,
    tqd.NM_CURSO AS programa,
    tqd.tipo_orientacao,
    COUNT(tqd.UID_ORIENTACAO) AS total_orientacoes,
    -- Estatísticas de tempo
    ROUND(AVG(tqd.dias_entre_qual_defesa), 1) AS media_dias,
    ROUND(AVG(tqd.meses_entre_qual_defesa), 1) AS media_meses,
    MIN(tqd.dias_entre_qual_defesa) AS min_dias,
    MAX(tqd.dias_entre_qual_defesa) AS max_dias,
    -- Comparação com a média do programa
    ROUND(AVG(tqd.dias_entre_qual_defesa) - 
          AVG(AVG(tqd.dias_entre_qual_defesa)) OVER (
              PARTITION BY tqd.UID_CURSO, tqd.CODE_TIPO_ORIENTACAO
          ), 1) AS diff_da_media_programa_dias,
    -- Percentil do orientador dentro do programa
    PERCENT_RANK() OVER (
        PARTITION BY tqd.UID_CURSO, tqd.CODE_TIPO_ORIENTACAO
        ORDER BY AVG(tqd.dias_entre_qual_defesa)
    ) AS percentil_eficiencia
FROM 
    TempoQualificacaoDefesa tqd
GROUP BY 
    tqd.UID_ORIENTADOR, tqd.orientador, tqd.NM_TITULACAO, 
    tqd.NM_DEPARTAMENTO, tqd.UID_CURSO, tqd.NM_CURSO, 
    tqd.CODE_TIPO_ORIENTACAO, tqd.tipo_orientacao
HAVING 
    COUNT(tqd.UID_ORIENTACAO) >= 3 -- Mínimo de 3 orientações para análise significativa
ORDER BY 
    tqd.NM_CURSO, tqd.tipo_orientacao, media_dias;
```

## 6. Identificar áreas temáticas emergentes baseadas em análise de palavras-chave de publicações recentes

```sql
WITH PalavrasChave AS (
    -- Extrai palavras-chave individuais de publicações
    SELECT 
        p.UID_PUBLICACAO,
        p.DATE_PUBLICACAO,
        EXTRACT(YEAR FROM p.DATE_PUBLICACAO) AS ano_publicacao,
        TRIM(UNNEST(STRING_TO_ARRAY(UPPER(p.NM_PALAVRAS_CHAVE), ','))) AS palavra_chave
    FROM 
        TB_PUBLICACAO p
    WHERE 
        p.NM_PALAVRAS_CHAVE IS NOT NULL AND
        p.ST_REGISTRO_ATIVO = 'S'
),
ContageAnual AS (
    -- Contagem anual de palavras-chave
    SELECT 
        pc.palavra_chave,
        pc.ano_publicacao,
        COUNT(*) AS ocorrencias
    FROM 
        PalavrasChave pc
    GROUP BY 
        pc.palavra_chave, pc.ano_publicacao
),
ContageAnterior AS (
    -- Contagem de períodos anteriores para comparação
    SELECT 
        ca.palavra_chave,
        ca.ano_publicacao,
        ca.ocorrencias,
        AVG(ca2.ocorrencias) AS media_ocorrencias_periodo_anterior
    FROM 
        ContageAnual ca
    LEFT JOIN 
        ContageAnual ca2 ON ca.palavra_chave = ca2.palavra_chave AND
                             ca2.ano_publicacao BETWEEN ca.ano_publicacao - 3 AND ca.ano_publicacao - 1
    GROUP BY 
        ca.palavra_chave, ca.ano_publicacao, ca.ocorrencias
),
Tendencias AS (
    -- Calcula tendências e classifica temas emergentes
    SELECT 
        ca.palavra_chave,
        ca.ano_publicacao,
        ca.ocorrencias,
        ca.media_ocorrencias_periodo_anterior,
        -- Taxa de crescimento
        CASE 
            WHEN ca.media_ocorrencias_periodo_anterior IS NULL OR ca.media_ocorrencias_periodo_anterior = 0 
            THEN NULL -- Palavra-chave nova
            ELSE (ca.ocorrencias - ca.media_ocorrencias_periodo_anterior) / ca.media_ocorrencias_periodo_anterior
        END AS taxa_crescimento,
        -- Classificação da tendência
        CASE
            WHEN ca.media_ocorrencias_periodo_anterior IS NULL THEN 'NOVA'
            WHEN ca.ocorrencias >= 5 AND 
                 (ca.ocorrencias - ca.media_ocorrencias_periodo_anterior) / ca.media_ocorrencias_periodo_anterior >= 0.5
                 THEN 'EMERGENTE'
            WHEN ca.ocorrencias >= 10 AND 
                 (ca.ocorrencias - ca.media_ocorrencias_periodo_anterior) / ca.media_ocorrencias_periodo_anterior BETWEEN 0.1 AND 0.5
                 THEN 'CRESCENTE'
            WHEN ca.ocorrencias >= 10 AND 
                 ABS((ca.ocorrencias - ca.media_ocorrencias_periodo_anterior) / ca.media_ocorrencias_periodo_anterior) < 0.1
                 THEN 'ESTÁVEL'
            WHEN ca.ocorrencias >= 5 AND 
                 (ca.ocorrencias - ca.media_ocorrencias_periodo_anterior) / ca.media_ocorrencias_periodo_anterior <= -0.3
                 THEN 'DECLINANTE'
            ELSE 'OUTRAS'
        END AS tendencia
    FROM 
        ContageAnterior ca
    WHERE 
        ca.ocorrencias >= 3 -- Mínimo de ocorrências para considerar relevante
)
SELECT 
    t.palavra_chave,
    t.ano_publicacao,
    t.ocorrencias,
    ROUND(t.media_ocorrencias_periodo_anterior, 2) AS media_anterior,
    ROUND(t.taxa_crescimento * 100, 2) AS crescimento_percentual,
    t.tendencia,
    -- Lista de linhas de pesquisa relacionadas
    STRING_AGG(DISTINCT lp.NM_LINHA, '; ') AS linhas_pesquisa_relacionadas,
    -- Lista de grupos de pesquisa relacionados
    STRING_AGG(DISTINCT gp.NM_GRUPO, '; ') AS grupos_pesquisa_relacionados
FROM 
    Tendencias t
-- Relaciona com linhas e grupos de pesquisa
LEFT JOIN TB_PUBLICACAO p ON p.NM_PALAVRAS_CHAVE LIKE '%' || t.palavra_chave || '%'
LEFT JOIN RT_PROJETO_PUBLICACAO pp ON p.UID_PUBLICACAO = pp.UID_PUBLICACAO
LEFT JOIN TB_PROJETO proj ON pp.UID_PROJETO = proj.UID_PROJETO
LEFT JOIN TB_LINHA_PESQUISA lp ON proj.UID_LINHA = lp.UID_LINHA
LEFT JOIN TB_GRUPO_PESQUISA gp ON lp.UID_GRUPO = gp.UID_GRUPO
WHERE 
    t.tendencia IN ('NOVA', 'EMERGENTE', 'CRESCENTE') AND
    t.ano_publicacao >= EXTRACT(YEAR FROM CURRENT_DATE) - 3 -- Últimos 3 anos
GROUP BY 
    t.palavra_chave, t.ano_publicacao, t.ocorrencias, 
    t.media_ocorrencias_periodo_anterior, t.taxa_crescimento, t.tendencia
ORDER BY 
    t.ano_publicacao DESC,
    CASE t.tendencia
        WHEN 'EMERGENTE' THEN 1
        WHEN 'NOVA' THEN 2
        WHEN 'CRESCENTE' THEN 3
        ELSE 4
    END,
    t.ocorrencias DESC;
```

## 7. Análise do Impacto de Financiamentos na Produção Científica

```sql
WITH 
-- Obter datas de início dos financiamentos por projeto
financiamentos_projetos AS (
    SELECT 
        f.UID_PROJETO,
        MIN(f.DATE_INICIO) AS data_inicio_financiamento
    FROM 
        TB_FINANCIAMENTO f
    WHERE 
        f.UID_PROJETO IS NOT NULL
        AND f.ST_REGISTRO_ATIVO = 'S'
    GROUP BY 
        f.UID_PROJETO
),

-- Publicações antes e depois do financiamento
publicacoes_periodo AS (
    SELECT 
        p.UID_PROJETO,
        p.NM_PROJETO,
        CASE 
            WHEN pub.DATE_PUBLICACAO < fp.data_inicio_financiamento THEN 'PRE'
            ELSE 'POS'
        END AS periodo,
        COUNT(DISTINCT pub.UID_PUBLICACAO) AS total_publicacoes,
        EXTRACT(YEAR FROM AGE(
            COALESCE(MAX(pub.DATE_PUBLICACAO), fp.data_inicio_financiamento),
            COALESCE(MIN(pub.DATE_PUBLICACAO), fp.data_inicio_financiamento)
        )) AS anos_periodo
    FROM 
        TB_PROJETO p
    JOIN 
        financiamentos_projetos fp ON p.UID_PROJETO = fp.UID_PROJETO
    LEFT JOIN 
        RT_PROJETO_PUBLICACAO pp ON p.UID_PROJETO = pp.UID_PROJETO
    LEFT JOIN 
        TB_PUBLICACAO pub ON pp.UID_PUBLICACAO = pub.UID_PUBLICACAO
    WHERE 
        p.ST_REGISTRO_ATIVO = 'S'
        AND pub.ST_REGISTRO_ATIVO = 'S'
    GROUP BY 
        p.UID_PROJETO, p.NM_PROJETO, periodo, fp.data_inicio_financiamento
)

-- Resultados finais com média anual e comparação
SELECT 
    pp1.UID_PROJETO,
    pp1.NM_PROJETO,
    fp.data_inicio_financiamento,
    COALESCE(pp1.total_publicacoes, 0) AS publicacoes_pre,
    CASE 
        WHEN pp1.anos_periodo > 0 THEN ROUND(pp1.total_publicacoes::numeric / pp1.anos_periodo, 2)
        ELSE 0
    END AS media_anual_pre,
    COALESCE(pp2.total_publicacoes, 0) AS publicacoes_pos,
    CASE 
        WHEN pp2.anos_periodo > 0 THEN ROUND(pp2.total_publicacoes::numeric / pp2.anos_periodo, 2)
        ELSE 0
    END AS media_anual_pos,
    CASE 
        WHEN pp1.anos_periodo > 0 AND pp2.anos_periodo > 0 THEN 
            ROUND(((pp2.total_publicacoes::numeric / pp2.anos_periodo) / 
                  NULLIF(pp1.total_publicacoes::numeric / pp1.anos_periodo, 0) - 1) * 100, 2)
        ELSE NULL
    END AS percentual_aumento
FROM 
    financiamentos_projetos fp
LEFT JOIN 
    publicacoes_periodo pp1 ON fp.UID_PROJETO = pp1.UID_PROJETO AND pp1.periodo = 'PRE'
LEFT JOIN 
    publicacoes_periodo pp2 ON fp.UID_PROJETO = pp2.UID_PROJETO AND pp2.periodo = 'POS'
JOIN 
    TB_PROJETO p ON fp.UID_PROJETO = p.UID_PROJETO
ORDER BY 
    percentual_aumento DESC NULLS LAST;
```

## 8. Identificação de Potenciais Parceiros para Colaboração

```sql
WITH 
-- Palavras-chave por pesquisador (de publicações e linhas de pesquisa)
palavras_chave_pesquisador AS (
    -- Palavras-chave de publicações
    SELECT 
        ap.UID_PESSOA,
        UNNEST(STRING_TO_ARRAY(LOWER(pub.NM_PALAVRAS_CHAVE), ',')) AS palavra_chave
    FROM 
        RT_AUTOR_PUBLICACAO ap
    JOIN 
        TB_PUBLICACAO pub ON ap.UID_PUBLICACAO = pub.UID_PUBLICACAO
    WHERE 
        pub.NM_PALAVRAS_CHAVE IS NOT NULL
        AND pub.ST_REGISTRO_ATIVO = 'S'
    
    UNION
    
    -- Palavras-chave de linhas de pesquisa do pesquisador
    SELECT 
        mg.UID_PESSOA,
        UNNEST(STRING_TO_ARRAY(LOWER(lp.NM_PALAVRAS_CHAVE), ',')) AS palavra_chave
    FROM 
        RT_MEMBRO_GRUPO mg
    JOIN 
        TB_LINHA_PESQUISA lp ON mg.UID_GRUPO = lp.UID_GRUPO
    WHERE 
        lp.NM_PALAVRAS_CHAVE IS NOT NULL
        AND lp.ST_REGISTRO_ATIVO = 'S'
        AND mg.FLAG_ATIVO = 'S'
),

-- Contagem de palavras-chave comuns entre pesquisadores
colaboracao_potencial AS (
    SELECT 
        p1.UID_PESSOA AS pesquisador1,
        p2.UID_PESSOA AS pesquisador2,
        COUNT(DISTINCT p1.palavra_chave) AS palavras_chave_comuns
    FROM 
        palavras_chave_pesquisador p1
    JOIN 
        palavras_chave_pesquisador p2 ON p1.palavra_chave = p2.palavra_chave
                                      AND p1.UID_PESSOA < p2.UID_PESSOA  -- Evitar duplicações
    GROUP BY 
        p1.UID_PESSOA, p2.UID_PESSOA
    HAVING 
        COUNT(DISTINCT p1.palavra_chave) >= 3  -- Pelo menos 3 palavras-chave em comum
),

-- Verificar se já colaboraram em publicações
colaboracoes_existentes AS (
    SELECT 
        ap1.UID_PESSOA AS pesquisador1,
        ap2.UID_PESSOA AS pesquisador2,
        COUNT(DISTINCT ap1.UID_PUBLICACAO) AS publicacoes_conjuntas
    FROM 
        RT_AUTOR_PUBLICACAO ap1
    JOIN 
        RT_AUTOR_PUBLICACAO ap2 ON ap1.UID_PUBLICACAO = ap2.UID_PUBLICACAO
                               AND ap1.UID_PESSOA < ap2.UID_PESSOA  -- Evitar duplicações
    GROUP BY 
        ap1.UID_PESSOA, ap2.UID_PESSOA
)

-- Resultados finais - pesquisadores com interesses comuns que não colaboraram ou colaboraram pouco
SELECT 
    p1.NM_PESSOA AS pesquisador1,
    p2.NM_PESSOA AS pesquisador2,
    cp.palavras_chave_comuns,
    COALESCE(ce.publicacoes_conjuntas, 0) AS publicacoes_conjuntas,
    -- Cálculo do índice de potencial de colaboração (mais palavras-chave comuns, menos publicações conjuntas)
    cp.palavras_chave_comuns - COALESCE(ce.publicacoes_conjuntas, 0) AS potencial_colaboracao,
    -- Lista de interesses comuns
    (
        SELECT STRING_AGG(DISTINCT TRIM(pkp1.palavra_chave), ', ')
        FROM palavras_chave_pesquisador pkp1
        JOIN palavras_chave_pesquisador pkp2 ON pkp1.palavra_chave = pkp2.palavra_chave
        WHERE pkp1.UID_PESSOA = cp.pesquisador1 AND pkp2.UID_PESSOA = cp.pesquisador2
    ) AS interesses_comuns
FROM 
    colaboracao_potencial cp
LEFT JOIN 
    colaboracoes_existentes ce ON cp.pesquisador1 = ce.pesquisador1 AND cp.pesquisador2 = ce.pesquisador2
JOIN 
    TB_PESSOA p1 ON cp.pesquisador1 = p1.UID_PESSOA
JOIN 
    TB_PESSOA p2 ON cp.pesquisador2 = p2.UID_PESSOA
WHERE 
    p1.FLAG_ATIVO = 'S' AND p2.FLAG_ATIVO = 'S'
    AND (ce.publicacoes_conjuntas IS NULL OR ce.publicacoes_conjuntas < 3)  -- Sem colaboração ou com poucas colaborações
ORDER BY 
    potencial_colaboracao DESC, palavras_chave_comuns DESC
LIMIT 50;
```

## 9. Cálculo do Retorno Acadêmico de Participações em Eventos

```sql
WITH 
-- Participações em eventos por pessoa
participacoes_eventos AS (
    SELECT 
        pe.UID_PESSOA,
        pe.UID_EVENTO,
        e.NM_EVENTO,
        e.DATE_FIM AS data_fim_evento,
        pe.CODE_TIPO_PARTICIPACAO,
        pe.FLAG_APRESENTACAO_ORAL,
        pe.UID_PUBLICACAO AS publicacao_apresentada
    FROM 
        TB_PARTICIPACAO_EVENTO pe
    JOIN 
        TB_EVENTO e ON pe.UID_EVENTO = e.UID_EVENTO
    WHERE 
        e.ST_REGISTRO_ATIVO = 'S'
),

-- Publicações após eventos (dentro de 18 meses após o evento)
publicacoes_pos_evento AS (
    SELECT 
        pe.UID_PESSOA,
        pe.UID_EVENTO,
        pe.data_fim_evento,
        pub.UID_PUBLICACAO,
        pub.NM_TITULO,
        pub.DATE_PUBLICACAO,
        pub.CNT_CITACOES,
        v.NM_QUALIS,
        v.CNT_FATOR_IMPACTO,
        EXTRACT(MONTH FROM AGE(pub.DATE_PUBLICACAO, pe.data_fim_evento)) AS meses_apos_evento
    FROM 
        participacoes_eventos pe
    JOIN 
        RT_AUTOR_PUBLICACAO ap ON pe.UID_PESSOA = ap.UID_PESSOA
    JOIN 
        TB_PUBLICACAO pub ON ap.UID_PUBLICACAO = pub.UID_PUBLICACAO
    JOIN 
        TB_VEICULO_PUBLICACAO v ON pub.UID_VEICULO = v.UID_VEICULO
    WHERE 
        pub.DATE_PUBLICACAO > pe.data_fim_evento
        AND pub.DATE_PUBLICACAO <= pe.data_fim_evento + INTERVAL '18 months'
        AND pub.UID_PUBLICACAO != pe.publicacao_apresentada  -- Excluir a própria publicação apresentada
        AND pub.ST_REGISTRO_ATIVO = 'S'
        AND v.ST_REGISTRO_ATIVO = 'S'
),

-- Métricas de retorno por evento e pessoa
metricas_retorno AS (
    SELECT 
        pe.UID_PESSOA,
        pe.UID_EVENTO,
        pe.NM_EVENTO,
        tp.NM_TIPO AS tipo_participacao,
        CASE WHEN pe.FLAG_APRESENTACAO_ORAL = 'S' THEN 'SIM' ELSE 'NÃO' END AS apresentou_trabalho,
        COUNT(DISTINCT ppe.UID_PUBLICACAO) AS total_publicacoes,
        COALESCE(SUM(ppe.CNT_CITACOES), 0) AS total_citacoes,
        COALESCE(AVG(ppe.meses_apos_evento), 0) AS media_meses_ate_publicacao,
        COUNT(DISTINCT CASE WHEN ppe.NM_QUALIS IN ('A1', 'A2', 'B1') OR ppe.CNT_FATOR_IMPACTO > 1.5 THEN ppe.UID_PUBLICACAO END) AS publicacoes_alto_impacto
    FROM 
        participacoes_eventos pe
    LEFT JOIN 
        publicacoes_pos_evento ppe ON pe.UID_PESSOA = ppe.UID_PESSOA AND pe.UID_EVENTO = ppe.UID_EVENTO
    JOIN 
        DM_TIPO_PARTICIPACAO tp ON pe.CODE_TIPO_PARTICIPACAO = tp.CODE_TIPO_PARTICIPACAO
    GROUP BY 
        pe.UID_PESSOA, pe.UID_EVENTO, pe.NM_EVENTO, tp.NM_TIPO, pe.FLAG_APRESENTACAO_ORAL
)

-- Resultados finais com ROI acadêmico
SELECT 
    p.NM_PESSOA,
    mr.NM_EVENTO,
    e.DATE_INICIO AS data_inicio_evento,
    e.DATE_FIM AS data_fim_evento,
    mr.tipo_participacao,
    mr.apresentou_trabalho,
    mr.total_publicacoes,
    mr.total_citacoes,
    mr.publicacoes_alto_impacto,
    ROUND(mr.media_meses_ate_publicacao, 1) AS media_meses_ate_publicacao,
    -- Cálculo do ROI acadêmico (ponderação de publicações e citações)
    ROUND((mr.total_publicacoes * 2 + mr.publicacoes_alto_impacto * 3 + mr.total_citacoes * 0.5)::numeric, 2) AS roi_academico,
    -- Eficiência de produção (publicações por mês)
    CASE 
        WHEN mr.media_meses_ate_publicacao > 0 THEN 
            ROUND((mr.total_publicacoes / mr.media_meses_ate_publicacao)::numeric, 2)
        ELSE 0
    END AS eficiencia_producao
FROM 
    metricas_retorno mr
JOIN 
    TB_PESSOA p ON mr.UID_PESSOA = p.UID_PESSOA
JOIN 
    TB_EVENTO e ON mr.UID_EVENTO = e.UID_EVENTO
WHERE 
    p.FLAG_ATIVO = 'S'
ORDER BY 
    roi_academico DESC, total_publicacoes DESC, total_citacoes DESC;
```

## 10. Previsão de Prazos de Conclusão de Orientações

```sql
WITH 
-- Histórico de orientações concluídas
orientacoes_concluidas AS (
    SELECT 
        o.UID_ORIENTADOR,
        o.CODE_TIPO_ORIENTACAO,
        o.DATE_INICIO,
        o.DATE_FIM_REAL,
        EXTRACT(MONTH FROM AGE(o.DATE_FIM_REAL, o.DATE_INICIO)) AS duracao_meses,
        o.CODE_SITUACAO
    FROM 
        TB_ORIENTACAO o
    WHERE 
        o.DATE_FIM_REAL IS NOT NULL
        AND o.CODE_SITUACAO = 'CN'  -- Concluído
        AND o.ST_REGISTRO_ATIVO = 'S'
),

-- Métricas históricas por orientador e tipo de orientação
metricas_orientador AS (
    SELECT 
        oc.UID_ORIENTADOR,
        oc.CODE_TIPO_ORIENTACAO,
        COUNT(*) AS total_orientacoes_concluidas,
        ROUND(AVG(oc.duracao_meses), 1) AS media_duracao_meses,
        ROUND(STDDEV(oc.duracao_meses), 1) AS desvio_padrao_meses,
        MIN(oc.duracao_meses) AS min_duracao_meses,
        MAX(oc.duracao_meses) AS max_duracao_meses,
        -- Tendência de tempo (usando window functions para análise temporal)
        ROUND(
            REGR_SLOPE(
                oc.duracao_meses, 
                EXTRACT(EPOCH FROM oc.DATE_INICIO - MIN(oc.DATE_INICIO) OVER (PARTITION BY oc.UID_ORIENTADOR, oc.CODE_TIPO_ORIENTACAO)) / 86400 / 30
            ) * 12,  -- Converter para tendência anual
            2
        ) AS tendencia_anual
    FROM 
        orientacoes_concluidas oc
    GROUP BY 
        oc.UID_ORIENTADOR, oc.CODE_TIPO_ORIENTACAO
    HAVING 
        COUNT(*) >= 3  -- Pelo menos 3 orientações concluídas para análise significativa
),

-- Orientações em andamento
orientacoes_andamento AS (
    SELECT 
        o.UID_ORIENTACAO,
        o.UID_ORIENTADOR,
        o.UID_ORIENTANDO,
        o.CODE_TIPO_ORIENTACAO,
        o.NM_TITULO,
        o.DATE_INICIO,
        o.DATE_FIM_PREVISTO,
        EXTRACT(MONTH FROM AGE(CURRENT_DATE, o.DATE_INICIO)) AS meses_decorridos
    FROM 
        TB_ORIENTACAO o
    WHERE 
        o.DATE_FIM_REAL IS NULL
        AND o.CODE_SITUACAO = 'EA'  -- Em andamento
        AND o.ST_REGISTRO_ATIVO = 'S'
)

-- Resultados finais com previsão
SELECT 
    po.NM_PESSOA AS orientador,
    to2.NM_TIPO AS tipo_orientacao,
    pe.NM_PESSOA AS orientando,
    oa.NM_TITULO,
    oa.DATE_INICIO,
    oa.DATE_FIM_PREVISTO AS conclusao_prevista_original,
    oa.meses_decorridos AS meses_ate_agora,
    mo.media_duracao_meses,
    mo.desvio_padrao_meses,
    
    -- Previsão com base no histórico do orientador
    (oa.DATE_INICIO + (mo.media_duracao_meses || ' months')::interval)::date AS data_conclusao_prevista,
    
    -- Ajuste da previsão com base na tendência recente
    CASE 
        WHEN mo.tendencia_anual < 0 THEN 'Melhorando (redução de ' || ABS(mo.tendencia_anual) || ' meses/ano)'
        WHEN mo.tendencia_anual > 0 THEN 'Piorando (aumento de ' || mo.tendencia_anual || ' meses/ano)'
        ELSE 'Estável'
    END AS tendencia_conclusao,
    
    -- Risco de atraso
    CASE
        WHEN oa.meses_decorridos > mo.media_duracao_meses THEN 'ALTO'
        WHEN oa.meses_decorridos > mo.media_duracao_meses * 0.75 THEN 'MÉDIO'
        ELSE 'BAIXO'
    END AS risco_atraso,
    
    -- Prazo estimado com margem de erro (baseado no desvio padrão)
    (oa.DATE_INICIO + ((mo.media_duracao_meses - mo.desvio_padrao_meses) || ' months')::interval)::date AS prazo_otimista,
    (oa.DATE_INICIO + ((mo.media_duracao_meses + mo.desvio_padrao_meses) || ' months')::interval)::date AS prazo_pessimista,
    
    -- Comparação com média institucional
    (
        SELECT ROUND(AVG(duracao_meses), 1)
        FROM orientacoes_concluidas oc2
        JOIN TB_ORIENTACAO o2 ON oc2.UID_ORIENTADOR = o2.UID_ORIENTADOR 
                              AND oc2.CODE_TIPO_ORIENTACAO = o2.CODE_TIPO_ORIENTACAO
        WHERE o2.CODE_TIPO_ORIENTACAO = oa.CODE_TIPO_ORIENTACAO
    ) AS media_institucional
FROM 
    orientacoes_andamento oa
JOIN 
    metricas_orientador mo ON oa.UID_ORIENTADOR = mo.UID_ORIENTADOR AND oa.CODE_TIPO_ORIENTACAO = mo.CODE_TIPO_ORIENTACAO
JOIN 
    TB_PESSOA po ON oa.UID_ORIENTADOR = po.UID_PESSOA
JOIN 
    TB_PESSOA pe ON oa.UID_ORIENTANDO = pe.UID_PESSOA
JOIN 
    DM_TIPO_ORIENTACAO to2 ON oa.CODE_TIPO_ORIENTACAO = to2.CODE_TIPO_ORIENTACAO
ORDER BY 
    risco_atraso DESC, meses_decorridos DESC;
```
